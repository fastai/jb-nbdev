
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Basic functionality &#8212; JupyterBook fastcore docs</title>
    
  <link rel="stylesheet" href="_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://fastai.github.io/jb-fastcore/01_basics.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Test" href="00_test.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />


<!-- Opengraph tags -->
<meta property="og:url"         content="https://fastai.github.io/jb-fastcore/01_basics.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="Basic functionality" />
<meta property="og:description" content="Basic functionality  Basic functionality used in the fastai library  Basics  # export defaults = SimpleNamespace()  # export def ifnone(a, b):     &#34;`b` if `a` i" />
<meta property="og:image"       content="https://fastai.github.io/jb-fastcore/_static/logo.png" />

<meta name="twitter:card" content="summary" />


  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  <img src="_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">JupyterBook fastcore docs</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="index.html">
   Welcome to fastcore
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="00_test.html">
   Test
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Basic functionality
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="#export">
   Export -
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/01_basics.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/fastai/jb-fastcore/master?urlpath=tree/docs/01_basics.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Basic functionality
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#basics">
     Basics
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#noop">
     NoOp
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#infinite-lists">
     Infinite Lists
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#operator-functions">
     Operator Functions
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#attribute-helpers">
     Attribute Helpers
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#attribute-delegation">
     Attribute Delegation
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#extensible-types">
     Extensible Types
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#collection-functions">
     Collection functions
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fastuple">
     fastuple
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#friendly-init-behavior">
       Friendly init behavior
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#elementwise-operations">
       Elementwise operations
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#other-elementwise-operations">
       Other Elementwise Operations
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#functions-on-functions">
     Functions on Functions
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#self-with-an-uppercase-s">
       Self (with an
       <em>
        uppercase
       </em>
       S)
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#patching">
     Patching
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#other-helpers">
     Other Helpers
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#notebook-functions">
     Notebook functions
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#export">
   Export -
  </a>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#default_exp basics</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="kn">from</span> <span class="nn">fastcore.imports</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">builtins</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">fastcore.test</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">nbdev.showdoc</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">fastcore.nb_imports</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="basic-functionality">
<h1>Basic functionality<a class="headerlink" href="#basic-functionality" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div><p>Basic functionality used in the fastai library</p>
</div></blockquote>
<div class="section" id="basics">
<h2>Basics<a class="headerlink" href="#basics" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># export</span>
<span class="n">defaults</span> <span class="o">=</span> <span class="n">SimpleNamespace</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># export</span>
<span class="k">def</span> <span class="nf">ifnone</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="s2">&quot;`b` if `a` is None else `a`&quot;</span>
    <span class="k">return</span> <span class="n">b</span> <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">a</span>
</pre></div>
</div>
</div>
</div>
<p>Since <code class="docutils literal notranslate"><span class="pre">b</span> <span class="pre">if</span> <span class="pre">a</span> <span class="pre">is</span> <span class="pre">None</span> <span class="pre">else</span> <span class="pre">a</span></code> is such a common pattern, we wrap it in a function. However, be careful, because python will evaluate <em>both</em> <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> when calling <code class="docutils literal notranslate"><span class="pre">ifnone</span></code> (which it doesn’t do if using the <code class="docutils literal notranslate"><span class="pre">if</span></code> version directly).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">ifnone</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">ifnone</span><span class="p">(</span><span class="mi">2</span>   <span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">maybe_attr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
    <span class="s2">&quot;`getattr(o,attr,o)`&quot;</span>
    <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span><span class="n">attr</span><span class="p">,</span><span class="n">o</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Return the attribute <code class="docutils literal notranslate"><span class="pre">attr</span></code> for object <code class="docutils literal notranslate"><span class="pre">o</span></code>.  If the attribute doesn’t exist, then return the object <code class="docutils literal notranslate"><span class="pre">o</span></code> instead.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">myobj</span><span class="p">:</span> <span class="n">myattr</span><span class="o">=</span><span class="s1">&#39;foo&#39;</span>

<span class="n">test_eq</span><span class="p">(</span><span class="n">maybe_attr</span><span class="p">(</span><span class="n">myobj</span><span class="p">,</span> <span class="s1">&#39;myattr&#39;</span><span class="p">),</span> <span class="s1">&#39;foo&#39;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">maybe_attr</span><span class="p">(</span><span class="n">myobj</span><span class="p">,</span> <span class="s1">&#39;another_attr&#39;</span><span class="p">),</span> <span class="n">myobj</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">basic_repr</span><span class="p">(</span><span class="n">flds</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">flds</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span> <span class="n">flds</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;, *&#39;</span><span class="p">,</span> <span class="n">flds</span><span class="p">)</span>
    <span class="n">flds</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">flds</span> <span class="ow">or</span> <span class="p">[])</span>
    <span class="k">def</span> <span class="nf">_f</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">o</span><span class="si">}</span><span class="s1">=</span><span class="si">{</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">o</span><span class="p">)</span><span class="si">!r}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">flds</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1">(</span><span class="si">{</span><span class="n">sig</span><span class="si">}</span><span class="s1">)&#39;</span>
    <span class="k">return</span> <span class="n">_f</span>
</pre></div>
</div>
</div>
</div>
<p>Lookup a user-supplied list of attributes (<code class="docutils literal notranslate"><span class="pre">flds</span></code>) of an object and generate a string with the name of each attribute and its corresponding value. The format of this string is <code class="docutils literal notranslate"><span class="pre">key=value</span></code>, where <code class="docutils literal notranslate"><span class="pre">key</span></code> is the name of the attribute, and <code class="docutils literal notranslate"><span class="pre">value</span></code> is the value of the attribute.  For each value, attempt to use the <code class="docutils literal notranslate"><span class="pre">__name__</span></code> attribute, otherwise fall back to using the value’s <code class="docutils literal notranslate"><span class="pre">__repr__</span></code> when constructing the string.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SomeClass</span><span class="p">:</span>
    <span class="n">a</span><span class="o">=</span><span class="mi">1</span>
    <span class="n">b</span><span class="o">=</span><span class="s1">&#39;foo&#39;</span>
    <span class="fm">__repr__</span><span class="o">=</span><span class="n">basic_repr</span><span class="p">(</span><span class="s1">&#39;a,b&#39;</span><span class="p">)</span>
    <span class="vm">__name__</span><span class="o">=</span><span class="s1">&#39;some-class&#39;</span>
    
<span class="k">class</span> <span class="nc">AnotherClass</span><span class="p">:</span>
    <span class="n">c</span><span class="o">=</span><span class="n">SomeClass</span><span class="p">()</span>
    <span class="n">d</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span>
    <span class="fm">__repr__</span><span class="o">=</span><span class="n">basic_repr</span><span class="p">([</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">])</span>
    
<span class="n">sc</span> <span class="o">=</span> <span class="n">SomeClass</span><span class="p">()</span>    
<span class="n">ac</span> <span class="o">=</span> <span class="n">AnotherClass</span><span class="p">()</span>

<span class="n">test_eq</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">sc</span><span class="p">),</span> <span class="s2">&quot;SomeClass(a=1, b=&#39;foo&#39;)&quot;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">ac</span><span class="p">),</span> <span class="s2">&quot;AnotherClass(c=SomeClass(a=1, b=&#39;foo&#39;), d=&#39;bar&#39;)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">is_array</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="s2">&quot;`True` if `x` supports `__array__` or `iloc`&quot;</span>
    <span class="k">return</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="s1">&#39;__array__&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="s1">&#39;iloc&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">is_array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span><span class="n">is_array</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(True, False)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">listify</span><span class="p">(</span><span class="n">o</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">rest</span><span class="p">,</span> <span class="n">use_list</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="s2">&quot;Convert `o` to a `list`&quot;</span>
    <span class="k">if</span> <span class="n">rest</span><span class="p">:</span> <span class="n">o</span> <span class="o">=</span> <span class="p">(</span><span class="n">o</span><span class="p">,)</span><span class="o">+</span><span class="n">rest</span>
    <span class="k">if</span> <span class="n">use_list</span><span class="p">:</span> <span class="n">res</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">o</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span> <span class="n">res</span> <span class="o">=</span> <span class="n">o</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="n">is_array</span><span class="p">(</span><span class="n">o</span><span class="p">):</span> <span class="n">res</span> <span class="o">=</span> <span class="p">[</span><span class="n">o</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">is_iter</span><span class="p">(</span><span class="n">o</span><span class="p">):</span> <span class="n">res</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> <span class="n">res</span> <span class="o">=</span> <span class="p">[</span><span class="n">o</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">is_coll</span><span class="p">(</span><span class="n">match</span><span class="p">):</span> <span class="n">match</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span> <span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="o">*</span><span class="n">match</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">)</span><span class="o">==</span><span class="n">match</span><span class="p">,</span> <span class="s1">&#39;Match length mismatch&#39;</span>
    <span class="k">return</span> <span class="n">res</span>
</pre></div>
</div>
</div>
</div>
<p>Conversion is designed to “do what you mean”, e.g:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">listify</span><span class="p">(</span><span class="s1">&#39;hi&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s1">&#39;hi&#39;</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">listify</span><span class="p">(</span><span class="n">array</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="p">[</span><span class="n">array</span><span class="p">(</span><span class="mi">1</span><span class="p">)])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">listify</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">listify</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]),</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">listify</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">listify</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span> <span class="p">[])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">listify</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">listify</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[array([[0, 1, 2],
        [3, 4, 5],
        [6, 7, 8]])]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">listify</span><span class="p">(</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[array([1, 2])]
</pre></div>
</div>
</div>
</div>
<p>Generators are turned into lists too:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gen</span> <span class="o">=</span> <span class="p">(</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">listify</span><span class="p">(</span><span class="n">gen</span><span class="p">),</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Use <code class="docutils literal notranslate"><span class="pre">match</span></code> to provide a length to match:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">listify</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">match</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">match</span></code> is a sequence, it’s length is used:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">listify</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">match</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>If the listified item is not of length <code class="docutils literal notranslate"><span class="pre">1</span></code>, it must be the same length as <code class="docutils literal notranslate"><span class="pre">match</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">listify</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">match</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">test_fail</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">listify</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">match</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">tuplify</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">use_list</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="s2">&quot;Make `o` a tuple&quot;</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">listify</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">use_list</span><span class="o">=</span><span class="n">use_list</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="n">match</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">tuplify</span><span class="p">(</span><span class="kc">None</span><span class="p">),())</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">tuplify</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">tuplify</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">match</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">true</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="s2">&quot;Test whether `x` is truthy; collections with &gt;0 elements are considered `True`&quot;</span>
    <span class="k">try</span><span class="p">:</span> <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="k">except</span><span class="p">:</span> <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[(</span><span class="n">o</span><span class="p">,</span><span class="n">true</span><span class="p">(</span><span class="n">o</span><span class="p">))</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span>
 <span class="p">(</span><span class="n">array</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="n">array</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]),</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(array(0), False),
 (array(1), True),
 (array([0]), True),
 (array([0, 1]), True),
 (1, True),
 (0, False),
 (&#39;&#39;, False),
 (None, False)]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">class</span> <span class="nc">NullType</span><span class="p">:</span>
    <span class="s2">&quot;An object that is `False` and can be called, chained, and indexed&quot;</span>
    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">):</span><span class="k">return</span> <span class="n">null</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span><span class="k">return</span> <span class="n">null</span>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span><span class="k">return</span> <span class="n">null</span>
    <span class="k">def</span> <span class="fm">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="kc">False</span>

<span class="n">null</span> <span class="o">=</span> <span class="n">NullType</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">bool</span><span class="p">(</span><span class="n">null</span><span class="o">.</span><span class="n">hi</span><span class="p">()</span><span class="o">.</span><span class="n">there</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>False
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">tonull</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="s2">&quot;Convert `None` to `null`&quot;</span>
    <span class="k">return</span> <span class="n">null</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">x</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">bool</span><span class="p">(</span><span class="n">tonull</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">hi</span><span class="p">()</span><span class="o">.</span><span class="n">there</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>False
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">get_class</span><span class="p">(</span><span class="n">nm</span><span class="p">,</span> <span class="o">*</span><span class="n">fld_names</span><span class="p">,</span> <span class="n">sup</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">funcs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">flds</span><span class="p">):</span>
    <span class="s2">&quot;Dynamically create a class, optionally inheriting from `sup`, containing `fld_names`&quot;</span>
    <span class="n">attrs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fld_names</span><span class="p">:</span> <span class="n">attrs</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">listify</span><span class="p">(</span><span class="n">funcs</span><span class="p">):</span> <span class="n">attrs</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">flds</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> <span class="n">attrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="n">sup</span> <span class="o">=</span> <span class="n">ifnone</span><span class="p">(</span><span class="n">sup</span><span class="p">,</span> <span class="p">())</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sup</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span> <span class="n">sup</span><span class="o">=</span><span class="p">(</span><span class="n">sup</span><span class="p">,)</span>

    <span class="k">def</span> <span class="nf">_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">args</span><span class="p">):</span> <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">attrs</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">i</span><span class="p">],</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>

    <span class="n">all_flds</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="n">fld_names</span><span class="p">,</span><span class="o">*</span><span class="n">flds</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
    <span class="k">def</span> <span class="nf">_eq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">([</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">k</span><span class="p">)</span><span class="o">==</span><span class="nb">getattr</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">all_flds</span><span class="p">])</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">sup</span><span class="p">:</span> <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;__repr__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">basic_repr</span><span class="p">(</span><span class="n">all_flds</span><span class="p">)</span>
    <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;__init__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_init</span>
    <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;__eq__&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_eq</span>
    <span class="n">res</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">nm</span><span class="p">,</span> <span class="n">sup</span><span class="p">,</span> <span class="n">attrs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">doc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">res</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">doc</span>
    <span class="k">return</span> <span class="n">res</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">show_doc</span><span class="p">(</span><span class="n">get_class</span><span class="p">,</span> <span class="n">title_level</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<h4 id="get_class" class="doc_header"><code>get_class</code><a href="__main__.py#L2" class="source_link" style="float:right">[source]</a></h4>
<blockquote>
<div><p><code>get_class</code>(<strong><code class="docutils literal notranslate"><span class="pre">nm</span></code></strong>, <strong>*<code class="docutils literal notranslate"><span class="pre">fld_names</span></code></strong>, <strong><code class="docutils literal notranslate"><span class="pre">sup</span></code></strong>=<em><code class="docutils literal notranslate"><span class="pre">None</span></code></em>, <strong><code class="docutils literal notranslate"><span class="pre">doc</span></code></strong>=<em><code class="docutils literal notranslate"><span class="pre">None</span></code></em>, <strong><code class="docutils literal notranslate"><span class="pre">funcs</span></code></strong>=<em><code class="docutils literal notranslate"><span class="pre">None</span></code></em>, <strong>**<code class="docutils literal notranslate"><span class="pre">flds</span></code></strong>)</p>
</div></blockquote>
<p>Dynamically create a class, optionally inheriting from <code class="docutils literal notranslate"><span class="pre">sup</span></code>, containing <code class="docutils literal notranslate"><span class="pre">fld_names</span></code></p>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">_t</span> <span class="o">=</span> <span class="n">get_class</span><span class="p">(</span><span class="s1">&#39;_t&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">_t</span><span class="p">()</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">_t</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">_t</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="s1">&#39;_t(a=1, b=3)&#39;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">t</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<p>Most often you’ll want to call <code class="docutils literal notranslate"><span class="pre">mk_class</span></code>, since it adds the class to your module. See <code class="docutils literal notranslate"><span class="pre">mk_class</span></code> for more details and examples of use (which also apply to <code class="docutils literal notranslate"><span class="pre">get_class</span></code>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">mk_class</span><span class="p">(</span><span class="n">nm</span><span class="p">,</span> <span class="o">*</span><span class="n">fld_names</span><span class="p">,</span> <span class="n">sup</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">funcs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mod</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">flds</span><span class="p">):</span>
    <span class="s2">&quot;Create a class using `get_class` and add to the caller&#39;s module&quot;</span>
    <span class="k">if</span> <span class="n">mod</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">mod</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">f_locals</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">get_class</span><span class="p">(</span><span class="n">nm</span><span class="p">,</span> <span class="o">*</span><span class="n">fld_names</span><span class="p">,</span> <span class="n">sup</span><span class="o">=</span><span class="n">sup</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="n">doc</span><span class="p">,</span> <span class="n">funcs</span><span class="o">=</span><span class="n">funcs</span><span class="p">,</span> <span class="o">**</span><span class="n">flds</span><span class="p">)</span>
    <span class="n">mod</span><span class="p">[</span><span class="n">nm</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span>
</pre></div>
</div>
</div>
</div>
<p>Any <code class="docutils literal notranslate"><span class="pre">kwargs</span></code> will be added as class attributes, and <code class="docutils literal notranslate"><span class="pre">sup</span></code> is an optional (tuple of) base classes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mk_class</span><span class="p">(</span><span class="s1">&#39;_t&#39;</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sup</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">_t</span><span class="p">()</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">assert</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="nb">dict</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">__init__</span></code> is provided that sets attrs for any <code class="docutils literal notranslate"><span class="pre">kwargs</span></code>, and for any <code class="docutils literal notranslate"><span class="pre">args</span></code> (matching by position to fields), along with a <code class="docutils literal notranslate"><span class="pre">__repr__</span></code> which prints all attrs. The docstring is set to <code class="docutils literal notranslate"><span class="pre">doc</span></code>. You can pass <code class="docutils literal notranslate"><span class="pre">funcs</span></code> which will be added as attrs with the function names.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="mi">1</span>
<span class="n">mk_class</span><span class="p">(</span><span class="s1">&#39;_t&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">sup</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;test doc&#39;</span><span class="p">,</span> <span class="n">funcs</span><span class="o">=</span><span class="n">foo</span><span class="p">)</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">_t</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">foo</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">,</span> <span class="s1">&#39;test doc&#39;</span><span class="p">)</span>
<span class="n">t</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">wrap_class</span><span class="p">(</span><span class="n">nm</span><span class="p">,</span> <span class="o">*</span><span class="n">fld_names</span><span class="p">,</span> <span class="n">sup</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">funcs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">flds</span><span class="p">):</span>
    <span class="s2">&quot;Decorator: makes function a method of a new class `nm` passing parameters to `mk_class`&quot;</span>
    <span class="k">def</span> <span class="nf">_inner</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="n">mk_class</span><span class="p">(</span><span class="n">nm</span><span class="p">,</span> <span class="o">*</span><span class="n">fld_names</span><span class="p">,</span> <span class="n">sup</span><span class="o">=</span><span class="n">sup</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="n">doc</span><span class="p">,</span> <span class="n">funcs</span><span class="o">=</span><span class="n">listify</span><span class="p">(</span><span class="n">funcs</span><span class="p">)</span><span class="o">+</span><span class="p">[</span><span class="n">f</span><span class="p">],</span> <span class="n">mod</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">,</span> <span class="o">**</span><span class="n">flds</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span>
    <span class="k">return</span> <span class="n">_inner</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@wrap_class</span><span class="p">(</span><span class="s1">&#39;_t&#39;</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span><span class="o">+</span><span class="mi">1</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">_t</span><span class="p">()</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">class</span> <span class="nc">ignore_exceptions</span><span class="p">:</span>
    <span class="s2">&quot;Context manager to ignore exceptions&quot;</span>
    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">pass</span>
    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span> <span class="k">return</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">show_doc</span><span class="p">(</span><span class="n">ignore_exceptions</span><span class="p">,</span> <span class="n">title_level</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<h4 id="ignore_exceptions" class="doc_header"><code>class</code> <code>ignore_exceptions</code><a href="" class="source_link" style="float:right">[source]</a></h4>
<blockquote>
<div><p><code>ignore_exceptions</code>()</p>
</div></blockquote>
<p>Context manager to ignore exceptions</p>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">ignore_exceptions</span><span class="p">():</span> 
    <span class="c1"># Exception will be ignored</span>
    <span class="k">raise</span> <span class="ne">Exception</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">exec_local</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">var_name</span><span class="p">):</span>
    <span class="s2">&quot;Call `exec` on `code` and return the var `var_name&quot;</span>
    <span class="n">loc</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">exec</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="nb">globals</span><span class="p">(),</span> <span class="n">loc</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">loc</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">exec_local</span><span class="p">(</span><span class="s2">&quot;a=1&quot;</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">risinstance</span><span class="p">(</span><span class="n">types</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="s2">&quot;Curried `isinstance` but with args reversed&quot;</span>
    <span class="n">types</span> <span class="o">=</span> <span class="n">tuplify</span><span class="p">(</span><span class="n">types</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span> <span class="n">partial</span><span class="p">(</span><span class="n">risinstance</span><span class="p">,</span><span class="n">types</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">types</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">in</span> <span class="n">types</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="o">.</span><span class="vm">__mro__</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">types</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">risinstance</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">risinstance</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">risinstance</span><span class="p">(</span><span class="nb">int</span><span class="p">)(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">types</span></code> can also be strings:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">risinstance</span><span class="p">((</span><span class="s1">&#39;str&#39;</span><span class="p">,</span><span class="s1">&#39;int&#39;</span><span class="p">),</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">risinstance</span><span class="p">(</span><span class="s1">&#39;str&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">risinstance</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="noop">
<h2>NoOp<a class="headerlink" href="#noop" title="Permalink to this headline">¶</a></h2>
<p>These are used when you need a pass-through function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">show_doc</span><span class="p">(</span><span class="n">noop</span><span class="p">,</span> <span class="n">title_level</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<h4 id="noop" class="doc_header"><code>noop</code><a href="https://github.com/fastai/fastcore/tree/master/fastcore/imports.py#L35" class="source_link" style="float:right">[source]</a></h4>
<blockquote>
<div><p><code>noop</code>(<strong><code class="docutils literal notranslate"><span class="pre">x</span></code></strong>=<em><code class="docutils literal notranslate"><span class="pre">None</span></code></em>, <strong>*<code class="docutils literal notranslate"><span class="pre">args</span></code></strong>, <strong>**<code class="docutils literal notranslate"><span class="pre">kwargs</span></code></strong>)</p>
</div></blockquote>
<p>Do nothing</p>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">noop</span><span class="p">()</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">noop</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">show_doc</span><span class="p">(</span><span class="n">noops</span><span class="p">,</span> <span class="n">title_level</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<h4 id="noops" class="doc_header"><code>noops</code><a href="https://github.com/fastai/fastcore/tree/master/fastcore/imports.py#L39" class="source_link" style="float:right">[source]</a></h4>
<blockquote>
<div><p><code>noops</code>(<strong><code class="docutils literal notranslate"><span class="pre">x</span></code></strong>=<em><code class="docutils literal notranslate"><span class="pre">None</span></code></em>, <strong>*<code class="docutils literal notranslate"><span class="pre">args</span></code></strong>, <strong>**<code class="docutils literal notranslate"><span class="pre">kwargs</span></code></strong>)</p>
</div></blockquote>
<p>Do nothing (method)</p>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">_t</span><span class="p">:</span> <span class="n">foo</span><span class="o">=</span><span class="n">noops</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">_t</span><span class="p">()</span><span class="o">.</span><span class="n">foo</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="infinite-lists">
<h2>Infinite Lists<a class="headerlink" href="#infinite-lists" title="Permalink to this headline">¶</a></h2>
<p>These lists are useful for things like padding an array or adding index column(s) to arrays.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="c1">#hide</span>
<span class="k">class</span> <span class="nc">_InfMeta</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="n">itertools</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">zeros</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="n">itertools</span><span class="o">.</span><span class="n">cycle</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ones</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="k">return</span> <span class="n">itertools</span><span class="o">.</span><span class="n">cycle</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nones</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="n">itertools</span><span class="o">.</span><span class="n">cycle</span><span class="p">([</span><span class="kc">None</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">class</span> <span class="nc">Inf</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">_InfMeta</span><span class="p">):</span>
    <span class="s2">&quot;Infinite lists&quot;</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">show_doc</span><span class="p">(</span><span class="n">Inf</span><span class="p">,</span> <span class="n">title_level</span><span class="o">=</span><span class="mi">4</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<h4 id="Inf" class="doc_header"><code>class</code> <code>Inf</code><a href="" class="source_link" style="float:right">[source]</a></h4>
<blockquote>
<div><p><code>Inf</code>()</p>
</div></blockquote>
<p>Infinite lists</p>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Inf</span></code> defines the following properties:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">count:</span> <span class="pre">itertools.count()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">zeros:</span> <span class="pre">itertools.cycle([0])</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ones</span> <span class="pre">:</span> <span class="pre">itertools.cycle([1])</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nones:</span> <span class="pre">itertools.cycle([None])</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">([</span><span class="n">o</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">o</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">Inf</span><span class="o">.</span><span class="n">count</span><span class="p">)],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>

<span class="n">test_eq</span><span class="p">([</span><span class="n">o</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">o</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">Inf</span><span class="o">.</span><span class="n">zeros</span><span class="p">)],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span><span class="p">)</span>

<span class="n">test_eq</span><span class="p">([</span><span class="n">o</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">o</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">Inf</span><span class="o">.</span><span class="n">ones</span><span class="p">)],</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span><span class="p">)</span>

<span class="n">test_eq</span><span class="p">([</span><span class="n">o</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">o</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">Inf</span><span class="o">.</span><span class="n">nones</span><span class="p">)],</span>
        <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="operator-functions">
<h2>Operator Functions<a class="headerlink" href="#operator-functions" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="n">_dumobj</span> <span class="o">=</span> <span class="nb">object</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">_oper</span><span class="p">(</span><span class="n">op</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="n">_dumobj</span><span class="p">):</span> <span class="k">return</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">o</span><span class="p">:</span><span class="n">op</span><span class="p">(</span><span class="n">o</span><span class="p">,</span><span class="n">a</span><span class="p">))</span> <span class="k">if</span> <span class="n">b</span> <span class="ow">is</span> <span class="n">_dumobj</span> <span class="k">else</span> <span class="n">op</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_mk_op</span><span class="p">(</span><span class="n">nm</span><span class="p">,</span> <span class="n">mod</span><span class="p">):</span>
    <span class="s2">&quot;Create an operator using `oper` and add to the caller&#39;s module&quot;</span>
    <span class="n">op</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">operator</span><span class="p">,</span><span class="n">nm</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_inner</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">_dumobj</span><span class="p">):</span> <span class="k">return</span> <span class="n">_oper</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
    <span class="n">_inner</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="n">_inner</span><span class="o">.</span><span class="vm">__qualname__</span> <span class="o">=</span> <span class="n">nm</span>
    <span class="n">_inner</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Same as `operator.</span><span class="si">{</span><span class="n">nm</span><span class="si">}</span><span class="s1">`, or returns partial if 1 arg&#39;</span>
    <span class="n">mod</span><span class="p">[</span><span class="n">nm</span><span class="p">]</span> <span class="o">=</span> <span class="n">_inner</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">in_</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
    <span class="s2">&quot;`True` if `x in a`&quot;</span>
    <span class="k">return</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">a</span>

<span class="n">operator</span><span class="o">.</span><span class="n">in_</span> <span class="o">=</span> <span class="n">in_</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="n">_all_</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;lt&#39;</span><span class="p">,</span><span class="s1">&#39;gt&#39;</span><span class="p">,</span><span class="s1">&#39;le&#39;</span><span class="p">,</span><span class="s1">&#39;ge&#39;</span><span class="p">,</span><span class="s1">&#39;eq&#39;</span><span class="p">,</span><span class="s1">&#39;ne&#39;</span><span class="p">,</span><span class="s1">&#39;add&#39;</span><span class="p">,</span><span class="s1">&#39;sub&#39;</span><span class="p">,</span><span class="s1">&#39;mul&#39;</span><span class="p">,</span><span class="s1">&#39;truediv&#39;</span><span class="p">,</span><span class="s1">&#39;is_&#39;</span><span class="p">,</span><span class="s1">&#39;is_not&#39;</span><span class="p">,</span><span class="s1">&#39;in_&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;lt&#39;</span><span class="p">,</span><span class="s1">&#39;gt&#39;</span><span class="p">,</span><span class="s1">&#39;le&#39;</span><span class="p">,</span><span class="s1">&#39;ge&#39;</span><span class="p">,</span><span class="s1">&#39;eq&#39;</span><span class="p">,</span><span class="s1">&#39;ne&#39;</span><span class="p">,</span><span class="s1">&#39;add&#39;</span><span class="p">,</span><span class="s1">&#39;sub&#39;</span><span class="p">,</span><span class="s1">&#39;mul&#39;</span><span class="p">,</span><span class="s1">&#39;truediv&#39;</span><span class="p">,</span><span class="s1">&#39;is_&#39;</span><span class="p">,</span><span class="s1">&#39;is_not&#39;</span><span class="p">,</span><span class="s1">&#39;in_&#39;</span><span class="p">]:</span> <span class="n">_mk_op</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="nb">globals</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># test if element is in another</span>
<span class="k">assert</span> <span class="n">in_</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">))</span>
<span class="k">assert</span> <span class="n">in_</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>
<span class="k">assert</span> <span class="n">in_</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;fastai&#39;</span><span class="p">)</span>
<span class="n">test_fail</span><span class="p">(</span><span class="n">in_</span><span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="s1">&#39;fastai&#39;</span><span class="p">))</span>

<span class="c1"># use in_ as a partial</span>
<span class="k">assert</span> <span class="n">in_</span><span class="p">(</span><span class="s1">&#39;fastai&#39;</span><span class="p">)(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">in_</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">])(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">test_fail</span><span class="p">(</span><span class="n">in_</span><span class="p">(</span><span class="s1">&#39;fastai&#39;</span><span class="p">)(</span><span class="s1">&#39;h&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>In addition to <code class="docutils literal notranslate"><span class="pre">in_</span></code>, the following functions are provided matching the behavior of the equivalent versions in <code class="docutils literal notranslate"><span class="pre">operator</span></code>: <em>lt gt le ge eq ne add sub mul truediv is_ is_not</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lt</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="n">gt</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="n">is_</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">),</span><span class="n">in_</span><span class="p">(</span><span class="mi">0</span><span class="p">,[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(True, False, True, False)
</pre></div>
</div>
</div>
</div>
<p>Similarly to <code class="docutils literal notranslate"><span class="pre">_in</span></code>, they also have additional functionality: if you only pass one param, they return a partial function that passes that param as the second positional parameter.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lt</span><span class="p">(</span><span class="mi">5</span><span class="p">)(</span><span class="mi">3</span><span class="p">),</span><span class="n">gt</span><span class="p">(</span><span class="mi">5</span><span class="p">)(</span><span class="mi">3</span><span class="p">),</span><span class="n">is_</span><span class="p">(</span><span class="kc">None</span><span class="p">)(</span><span class="kc">None</span><span class="p">),</span><span class="n">in_</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(True, False, True, False)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">true</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="s2">&quot;Predicate: always `True`&quot;</span>
    <span class="k">return</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">true</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">true</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">true</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">true</span><span class="p">([])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="n">e</span><span class="o">=</span><span class="ne">StopIteration</span><span class="p">):</span>
    <span class="s2">&quot;Raises exception `e` (by default `StopException`)&quot;</span>
    <span class="k">raise</span> <span class="n">e</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">gen</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">seq</span><span class="p">,</span> <span class="n">cond</span><span class="o">=</span><span class="n">true</span><span class="p">):</span>
    <span class="s2">&quot;Like `(func(o) for o in seq if cond(func(o)))` but handles `StopIteration`&quot;</span>
    <span class="k">return</span> <span class="n">itertools</span><span class="o">.</span><span class="n">takewhile</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="nb">map</span><span class="p">(</span><span class="n">func</span><span class="p">,</span><span class="n">seq</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">gen</span><span class="p">(</span><span class="n">noop</span><span class="p">,</span> <span class="n">Inf</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="n">lt</span><span class="p">(</span><span class="mi">5</span><span class="p">)),</span>
        <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">gen</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">neg</span><span class="p">,</span> <span class="n">Inf</span><span class="o">.</span><span class="n">count</span><span class="p">,</span> <span class="n">gt</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">)),</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">4</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">gen</span><span class="p">(</span><span class="k">lambda</span> <span class="n">o</span><span class="p">:</span><span class="n">o</span> <span class="k">if</span> <span class="n">o</span><span class="o">&lt;</span><span class="mi">5</span> <span class="k">else</span> <span class="n">stop</span><span class="p">(),</span> <span class="n">Inf</span><span class="o">.</span><span class="n">count</span><span class="p">),</span>
        <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">chunked</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="n">chunk_sz</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">drop_last</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">n_chunks</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="s2">&quot;Return batches from iterator `it` of size `chunk_sz` (or return `n_chunks` total)&quot;</span>
    <span class="k">assert</span> <span class="nb">bool</span><span class="p">(</span><span class="n">chunk_sz</span><span class="p">)</span> <span class="o">^</span> <span class="nb">bool</span><span class="p">(</span><span class="n">n_chunks</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n_chunks</span><span class="p">:</span> <span class="n">chunk_sz</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">it</span><span class="p">)</span><span class="o">/</span><span class="n">n_chunks</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="n">Iterator</span><span class="p">):</span> <span class="n">it</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">it</span><span class="p">)</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">islice</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="n">chunk_sz</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">res</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">)</span><span class="o">==</span><span class="n">chunk_sz</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">drop_last</span><span class="p">):</span> <span class="k">yield</span> <span class="n">res</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">)</span><span class="o">&lt;</span><span class="n">chunk_sz</span><span class="p">:</span> <span class="k">return</span>
</pre></div>
</div>
</div>
</div>
<p>Note that you must pass either <code class="docutils literal notranslate"><span class="pre">chunk_sz</span></code>, or <code class="docutils literal notranslate"><span class="pre">n_chunks</span></code>, but not both.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">chunked</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span>      <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span> <span class="p">[</span><span class="mi">9</span><span class="p">]])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">chunked</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span>    <span class="p">])</span>

<span class="n">t</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">o</span><span class="p">:</span><span class="n">stop</span><span class="p">()</span> <span class="k">if</span> <span class="n">o</span><span class="o">==</span><span class="mi">6</span> <span class="k">else</span> <span class="n">o</span><span class="p">,</span> <span class="n">Inf</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">chunked</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]])</span>
<span class="n">t</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">o</span><span class="p">:</span><span class="n">stop</span><span class="p">()</span> <span class="k">if</span> <span class="n">o</span><span class="o">==</span><span class="mi">7</span> <span class="k">else</span> <span class="n">o</span><span class="p">,</span> <span class="n">Inf</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">chunked</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">6</span><span class="p">]])</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">chunked</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span>      <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span> <span class="p">[</span><span class="mi">9</span><span class="p">]])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">chunked</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span>    <span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">otherwise</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">tst</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="s2">&quot;`y if tst(x) else x`&quot;</span>
    <span class="k">return</span> <span class="n">y</span> <span class="k">if</span> <span class="n">tst</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">otherwise</span><span class="p">(</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">gt</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="mi">4</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">otherwise</span><span class="p">(</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">gt</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="mi">4</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="attribute-helpers">
<h2>Attribute Helpers<a class="headerlink" href="#attribute-helpers" title="Permalink to this headline">¶</a></h2>
<p>These functions reduce boilerplate when setting or manipulating attributes or properties of objects.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">custom_dir</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">add</span><span class="p">):</span>
    <span class="s2">&quot;Implement custom `__dir__`, adding `add` to `cls`&quot;</span>
    <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__dir__</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="n">listify</span><span class="p">(</span><span class="n">add</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">custom_dir</span></code> allows you extract the <a class="reference external" href="https://stackoverflow.com/questions/19907442/explain-dict-attribute"><code class="docutils literal notranslate"><span class="pre">__dict__</span></code> property of a class</a> and appends the list <code class="docutils literal notranslate"><span class="pre">add</span></code> to it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">_T</span><span class="p">:</span> 
    <span class="k">def</span> <span class="nf">f</span><span class="p">():</span> <span class="k">pass</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">custom_dir</span><span class="p">(</span><span class="n">_T</span><span class="p">(),</span> <span class="n">add</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">])</span>
<span class="k">assert</span> <span class="p">{</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span><span class="p">}</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">class</span> <span class="nc">AttrDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="s2">&quot;`dict` subclass that also provides access to keys as attrs&quot;</span>
    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">k</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span> <span class="k">else</span> <span class="n">stop</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">,</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">)[</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;_&#39;</span><span class="p">](</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__dir__</span><span class="p">()</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">show_doc</span><span class="p">(</span><span class="n">AttrDict</span><span class="p">,</span> <span class="n">title_level</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<h4 id="AttrDict" class="doc_header"><code>class</code> <code>AttrDict</code><a href="" class="source_link" style="float:right">[source]</a></h4>
<blockquote>
<div><p><code>AttrDict</code>() :: <code class="docutils literal notranslate"><span class="pre">dict</span></code></p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">dict</span></code> subclass that also provides access to keys as attrs</p>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="n">AttrDict</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="s2">&quot;two&quot;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">],</span> <span class="s1">&#39;two&#39;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="s1">&#39;nope&#39;</span><span class="p">),</span> <span class="s1">&#39;nope&#39;</span><span class="p">)</span>
<span class="n">d</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">d</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="k">assert</span> <span class="s1">&#39;a&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#exports</span>
<span class="k">def</span> <span class="nf">type_hints</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="s2">&quot;Same as `typing.get_type_hints` but returns `</span><span class="si">{}</span><span class="s2">` if not allowed type&quot;</span>
    <span class="k">return</span> <span class="n">typing</span><span class="o">.</span><span class="n">get_type_hints</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">_allowed_types</span><span class="p">)</span> <span class="k">else</span> <span class="p">{}</span>
</pre></div>
</div>
</div>
</div>
<p>Below is a list of allowed types for type hints in python:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">list</span><span class="p">(</span><span class="n">typing</span><span class="o">.</span><span class="n">_allowed_types</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[function,
 builtin_function_or_method,
 method,
 module,
 wrapper_descriptor,
 method-wrapper,
 method_descriptor]
</pre></div>
</div>
</div>
</div>
<p>For example, type <code class="docutils literal notranslate"><span class="pre">func</span></code> is allowed so <code class="docutils literal notranslate"><span class="pre">type_hints</span></code> returns the same value as <code class="docutils literal notranslate"><span class="pre">typing.get_hints</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="nb">int</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">bool</span><span class="p">:</span> <span class="o">...</span> <span class="c1"># a function with type hints (allowed)</span>
<span class="n">exp</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span><span class="s1">&#39;return&#39;</span><span class="p">:</span><span class="nb">bool</span><span class="p">}</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">type_hints</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">typing</span><span class="o">.</span><span class="n">get_type_hints</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">type_hints</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">exp</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>However, <code class="docutils literal notranslate"><span class="pre">class</span></code> is not an allowed type, so <code class="docutils literal notranslate"><span class="pre">type_hints</span></code> returns <code class="docutils literal notranslate"><span class="pre">{}</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">_T</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">bool</span><span class="p">:</span> <span class="o">...</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">type_hints</span><span class="p">(</span><span class="n">_T</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">annotations</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
    <span class="s2">&quot;Annotations for `o`, or `type(o)`&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">o</span><span class="p">:</span> <span class="k">return</span> <span class="n">res</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">type_hints</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="p">:</span> <span class="n">res</span> <span class="o">=</span> <span class="n">type_hints</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span><span class="s1">&#39;__init__&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="p">:</span> <span class="n">res</span> <span class="o">=</span> <span class="n">type_hints</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">o</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">res</span>
</pre></div>
</div>
</div>
</div>
<p>This supports a wider range of situations than <code class="docutils literal notranslate"><span class="pre">type_hints</span></code>, by checking <code class="docutils literal notranslate"><span class="pre">type()</span></code> and <code class="docutils literal notranslate"><span class="pre">__init__</span></code> for annotations too:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">_T</span><span class="p">,</span><span class="n">_T</span><span class="p">(),</span><span class="n">_T</span><span class="o">.</span><span class="fm">__init__</span><span class="p">,</span><span class="n">f</span><span class="p">:</span> <span class="n">test_eq</span><span class="p">(</span><span class="n">annotations</span><span class="p">(</span><span class="n">o</span><span class="p">),</span> <span class="n">exp</span><span class="p">)</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">annotations</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">annotations</span><span class="p">(</span><span class="nb">print</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">anno_ret</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="s2">&quot;Get the return annotation of `func`&quot;</span>
    <span class="k">return</span> <span class="n">annotations</span><span class="p">(</span><span class="n">func</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;return&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="n">func</span> <span class="k">else</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span> <span class="k">return</span> <span class="n">x</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">anno_ret</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="nb">float</span><span class="p">]:</span> <span class="k">return</span> <span class="n">x</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">anno_ret</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">typing</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="nb">float</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>If your return annotation is <code class="docutils literal notranslate"><span class="pre">None</span></code>, <code class="docutils literal notranslate"><span class="pre">anno_ret</span></code> will return <code class="docutils literal notranslate"><span class="pre">NoneType</span></code> (and not <code class="docutils literal notranslate"><span class="pre">None</span></code>):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span> <span class="n">x</span>

<span class="n">test_eq</span><span class="p">(</span><span class="n">anno_ret</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">NoneType</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">anno_ret</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="c1"># returns NoneType instead of None</span>
</pre></div>
</div>
</div>
</div>
<p>If your function does not have a return type, or if you pass in <code class="docutils literal notranslate"><span class="pre">None</span></code> instead of a function, then <code class="docutils literal notranslate"><span class="pre">anno_ret</span></code> returns <code class="docutils literal notranslate"><span class="pre">None</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span>

<span class="n">test_eq</span><span class="p">(</span><span class="n">anno_ret</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">anno_ret</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span> <span class="c1"># instead of passing in a func, pass in None</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">argnames</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">frame</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="s2">&quot;Names of arguments to function or frame `f`&quot;</span>
    <span class="n">code</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;f_code&#39;</span> <span class="k">if</span> <span class="n">frame</span> <span class="k">else</span> <span class="s1">&#39;__code__&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">code</span><span class="o">.</span><span class="n">co_varnames</span><span class="p">[:</span><span class="n">code</span><span class="o">.</span><span class="n">co_argcount</span><span class="o">+</span><span class="n">code</span><span class="o">.</span><span class="n">co_kwonlyargcount</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">argnames</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">with_cast</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="s2">&quot;Decorator which uses any parameter annotations as preprocessing functions&quot;</span>
    <span class="n">anno</span><span class="p">,</span> <span class="n">out_anno</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">annotations</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">anno_ret</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">argnames</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">c_out</span> <span class="o">=</span> <span class="n">ifnone</span><span class="p">(</span><span class="n">out_anno</span><span class="p">,</span> <span class="n">noop</span><span class="p">)</span>
    <span class="n">defaults</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">params</span><span class="p">),</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="vm">__defaults__</span> <span class="ow">or</span> <span class="p">{})))</span>
    <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_inner</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">anno</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">anno</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="n">v</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">i</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">):</span> <span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">:</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="n">defaults</span><span class="p">[</span><span class="n">v</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">c_out</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">_inner</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@with_cast</span>
<span class="k">def</span> <span class="nf">_f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span><span class="n">Path</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span> <span class="k">return</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">)</span>

<span class="n">test_eq</span><span class="p">(</span><span class="n">_f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">),</span><span class="s1">&#39;3&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">_f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">),</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>

<span class="nd">@with_cast</span>
<span class="k">def</span> <span class="nf">_g</span><span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">str</span><span class="p">:</span> <span class="k">return</span> <span class="n">a</span>

<span class="n">test_eq</span><span class="p">(</span><span class="n">_g</span><span class="p">(</span><span class="mf">4.0</span><span class="p">),</span> <span class="s1">&#39;4&#39;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">_g</span><span class="p">(</span><span class="mf">4.4</span><span class="p">),</span> <span class="s1">&#39;4&#39;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">_g</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;2&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">_store_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">anno</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">):</span>
    <span class="n">stored</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;__stored_args__&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">attrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">anno</span><span class="p">:</span> <span class="n">v</span> <span class="o">=</span> <span class="n">anno</span><span class="p">[</span><span class="n">n</span><span class="p">](</span><span class="n">v</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">stored</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">stored</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">store_attr</span><span class="p">(</span><span class="n">names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">but</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">cast</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">store_args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">):</span>
    <span class="s2">&quot;Store params named in comma-separated `names` from calling context into attrs in `self`&quot;</span>
    <span class="n">fr</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">argnames</span><span class="p">(</span><span class="n">fr</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="p">:</span> <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;self&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> <span class="bp">self</span> <span class="o">=</span> <span class="n">fr</span><span class="o">.</span><span class="n">f_locals</span><span class="p">[</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="k">if</span> <span class="n">store_args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">store_args</span> <span class="o">=</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;__slots__&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">store_args</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;__stored_args__&#39;</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">__stored_args__</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">anno</span> <span class="o">=</span> <span class="n">annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="k">if</span> <span class="n">cast</span> <span class="k">else</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">names</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">names</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span> <span class="n">names</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;, *&#39;</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>
    <span class="n">ns</span> <span class="o">=</span> <span class="n">names</span> <span class="k">if</span> <span class="n">names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;__slots__&#39;</span><span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
    <span class="n">added</span> <span class="o">=</span> <span class="p">{</span><span class="n">n</span><span class="p">:</span><span class="n">fr</span><span class="o">.</span><span class="n">f_locals</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">ns</span><span class="p">}</span>
    <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">attrs</span><span class="p">,</span> <span class="o">**</span><span class="n">added</span><span class="p">}</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">but</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span> <span class="n">but</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;, *&#39;</span><span class="p">,</span> <span class="n">but</span><span class="p">)</span>
    <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">attrs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">but</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">_store_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">anno</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>In it’s most basic form, you can use <code class="docutils literal notranslate"><span class="pre">store_attr</span></code> to shorten code like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">T</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span>
</pre></div>
</div>
</div>
</div>
<p>…to this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">T</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">):</span> <span class="n">store_attr</span><span class="p">(</span><span class="s1">&#39;a,b,c&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>This class behaves as if we’d used the first form:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">T</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">t</span><span class="o">.</span><span class="n">a</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">t</span><span class="o">.</span><span class="n">b</span><span class="o">==</span><span class="mi">3</span> <span class="ow">and</span> <span class="n">t</span><span class="o">.</span><span class="n">c</span><span class="o">==</span><span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
<p>In addition, it stores the attrs as a <code class="docutils literal notranslate"><span class="pre">dict</span></code> in <code class="docutils literal notranslate"><span class="pre">__stored_args__</span></code>, which you can use for display, logging, and so forth.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">__stored_args__</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<p>Since you normally want to use the first argument (often called <code class="docutils literal notranslate"><span class="pre">self</span></code>) for storing attributes, it’s optional:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">T</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span> <span class="n">store_attr</span><span class="p">(</span><span class="s1">&#39;a,b,c&#39;</span><span class="p">)</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">T</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">t</span><span class="o">.</span><span class="n">a</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">t</span><span class="o">.</span><span class="n">b</span><span class="o">==</span><span class="mi">3</span> <span class="ow">and</span> <span class="n">t</span><span class="o">.</span><span class="n">c</span><span class="o">==</span><span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#hide</span>
<span class="k">class</span> <span class="nc">_T</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">store_attr</span><span class="p">(</span><span class="s1">&#39;a,b,c&#39;</span><span class="p">)</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">_T</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">t</span><span class="o">.</span><span class="n">a</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">t</span><span class="o">.</span><span class="n">b</span><span class="o">==</span><span class="mi">3</span> <span class="ow">and</span> <span class="n">t</span><span class="o">.</span><span class="n">c</span><span class="o">==</span><span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
<p>With <code class="docutils literal notranslate"><span class="pre">cast=True</span></code> any parameter annotations will be used as preprocessing functions for the corresponding arguments:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">T</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span><span class="n">listify</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span> <span class="n">store_attr</span><span class="p">(</span><span class="s1">&#39;a,b,c&#39;</span><span class="p">,</span> <span class="n">cast</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">T</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">t</span><span class="o">.</span><span class="n">a</span><span class="o">==</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">t</span><span class="o">.</span><span class="n">b</span><span class="o">==</span><span class="mi">3</span> <span class="ow">and</span> <span class="n">t</span><span class="o">.</span><span class="n">c</span><span class="o">==</span><span class="s1">&#39;2&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>You can inherit from a class using <code class="docutils literal notranslate"><span class="pre">store_attr</span></code>, and just call it again to add in any new attributes added in the derived class:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">T2</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">store_attr</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">)</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">T2</span><span class="p">(</span><span class="n">d</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">t</span><span class="o">.</span><span class="n">a</span><span class="o">==</span><span class="mi">2</span> <span class="ow">and</span> <span class="n">t</span><span class="o">.</span><span class="n">b</span><span class="o">==</span><span class="mi">3</span> <span class="ow">and</span> <span class="n">t</span><span class="o">.</span><span class="n">c</span><span class="o">==</span><span class="mi">4</span> <span class="ow">and</span> <span class="n">t</span><span class="o">.</span><span class="n">d</span><span class="o">==</span><span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<p>You can skip passing a list of attrs to store. In this case, all arguments passed to the method are stored:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">T</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">):</span> <span class="n">store_attr</span><span class="p">()</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">T</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">t</span><span class="o">.</span><span class="n">a</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">t</span><span class="o">.</span><span class="n">b</span><span class="o">==</span><span class="mi">3</span> <span class="ow">and</span> <span class="n">t</span><span class="o">.</span><span class="n">c</span><span class="o">==</span><span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">T4</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">store_attr</span><span class="p">()</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">T4</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">t</span><span class="o">.</span><span class="n">a</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">t</span><span class="o">.</span><span class="n">b</span><span class="o">==</span><span class="mi">3</span> <span class="ow">and</span> <span class="n">t</span><span class="o">.</span><span class="n">c</span><span class="o">==</span><span class="mi">2</span> <span class="ow">and</span> <span class="n">t</span><span class="o">.</span><span class="n">d</span><span class="o">==</span><span class="mi">4</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">T4</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">store_attr</span><span class="p">()</span>
        
<span class="n">t</span> <span class="o">=</span> <span class="n">T4</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">t</span><span class="o">.</span><span class="n">a</span><span class="o">==</span><span class="mi">3</span> <span class="ow">and</span> <span class="n">t</span><span class="o">.</span><span class="n">b</span><span class="o">==</span><span class="mi">1</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">T4</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">t</span><span class="o">.</span><span class="n">a</span><span class="o">==</span><span class="mi">3</span> <span class="ow">and</span> <span class="n">t</span><span class="o">.</span><span class="n">b</span><span class="o">==</span><span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#hide</span>
<span class="c1"># ensure that subclasses work with or without `store_attr`</span>
<span class="k">class</span> <span class="nc">T4</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">store_attr</span><span class="p">()</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">T4</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">t</span><span class="o">.</span><span class="n">a</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">t</span><span class="o">.</span><span class="n">b</span><span class="o">==</span><span class="mi">3</span> <span class="ow">and</span> <span class="n">t</span><span class="o">.</span><span class="n">c</span><span class="o">==</span><span class="mi">2</span>

<span class="k">class</span> <span class="nc">T4</span><span class="p">(</span><span class="n">T</span><span class="p">):</span> <span class="k">pass</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">T4</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">t</span><span class="o">.</span><span class="n">a</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">t</span><span class="o">.</span><span class="n">b</span><span class="o">==</span><span class="mi">3</span> <span class="ow">and</span> <span class="n">t</span><span class="o">.</span><span class="n">c</span><span class="o">==</span><span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#hide</span>
<span class="c1">#ensure that kwargs work with names==None</span>
<span class="k">class</span> <span class="nc">T</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> <span class="n">store_attr</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">T</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">d</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">e</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">t</span><span class="o">.</span><span class="n">a</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">t</span><span class="o">.</span><span class="n">b</span><span class="o">==</span><span class="mi">3</span> <span class="ow">and</span> <span class="n">t</span><span class="o">.</span><span class="n">c</span><span class="o">==</span><span class="mi">2</span> <span class="ow">and</span> <span class="n">t</span><span class="o">.</span><span class="n">d</span><span class="o">==</span><span class="mi">4</span> <span class="ow">and</span> <span class="n">t</span><span class="o">.</span><span class="n">e</span><span class="o">==-</span><span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#hide</span>
<span class="c1">#ensure that kwargs work with names==&#39;&#39;</span>
<span class="k">class</span> <span class="nc">T</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">store_attr</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">T</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>You can skip some attrs by passing <code class="docutils literal notranslate"><span class="pre">but</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">T</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">):</span> <span class="n">store_attr</span><span class="p">(</span><span class="n">but</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">T</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">t</span><span class="o">.</span><span class="n">b</span><span class="o">==</span><span class="mi">3</span> <span class="ow">and</span> <span class="n">t</span><span class="o">.</span><span class="n">c</span><span class="o">==</span><span class="mi">2</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>You can also pass keywords to <code class="docutils literal notranslate"><span class="pre">store_attr</span></code>, which is identical to setting the attrs directly, but also stores them in <code class="docutils literal notranslate"><span class="pre">__stored_args__</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">T</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="n">store_attr</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">T</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">t</span><span class="o">.</span><span class="n">a</span><span class="o">==</span><span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<p>You can also use store_attr inside functions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_T</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">SimpleNamespace</span><span class="p">()</span>
    <span class="n">store_attr</span><span class="p">(</span><span class="bp">self</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">t</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">create_T</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">t</span><span class="o">.</span><span class="n">a</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">t</span><span class="o">.</span><span class="n">b</span><span class="o">==</span><span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">attrdict</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="o">*</span><span class="n">ks</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="s2">&quot;Dict from each `k` in `ks` to `getattr(o,k)`&quot;</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="nb">getattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ks</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">T</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">):</span> <span class="n">store_attr</span><span class="p">()</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">T</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">attrdict</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">properties</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">ps</span><span class="p">):</span>
    <span class="s2">&quot;Change attrs in `cls` with names in `ps` to properties&quot;</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ps</span><span class="p">:</span> <span class="nb">setattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="nb">property</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span><span class="n">p</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">T</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">a</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="mi">1</span>
    <span class="k">def</span> <span class="nf">b</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="mi">2</span>
<span class="n">properties</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>

<span class="n">test_eq</span><span class="p">(</span><span class="n">T</span><span class="p">()</span><span class="o">.</span><span class="n">a</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">T</span><span class="p">()</span><span class="o">.</span><span class="n">b</span><span class="p">(),</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="n">_c2w_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;((?&lt;=[a-z])[A-Z]|(?&lt;!\A)[A-Z](?=[a-z]))&#39;</span><span class="p">)</span>
<span class="n">_camel_re1</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;(.)([A-Z][a-z]+)&#39;</span><span class="p">)</span>
<span class="n">_camel_re2</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;([a-z0-9])([A-Z])&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">camel2words</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">space</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">):</span>
    <span class="s2">&quot;Convert CamelCase to &#39;spaced words&#39;&quot;</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">_c2w_re</span><span class="p">,</span> <span class="sa">rf</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">space</span><span class="si">}</span><span class="s1">\1&#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">camel2words</span><span class="p">(</span><span class="s1">&#39;ClassAreCamel&#39;</span><span class="p">),</span> <span class="s1">&#39;Class Are Camel&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">camel2snake</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="s2">&quot;Convert CamelCase to snake_case&quot;</span>
    <span class="n">s1</span>   <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">_camel_re1</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\1_\2&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">_camel_re2</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\1_\2&#39;</span><span class="p">,</span> <span class="n">s1</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">camel2snake</span><span class="p">(</span><span class="s1">&#39;ClassAreCamel&#39;</span><span class="p">),</span> <span class="s1">&#39;class_are_camel&#39;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">camel2snake</span><span class="p">(</span><span class="s1">&#39;Already_Snake&#39;</span><span class="p">),</span> <span class="s1">&#39;already__snake&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">snake2camel</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="s2">&quot;Convert snake_case to CamelCase&quot;</span>
    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">snake2camel</span><span class="p">(</span><span class="s1">&#39;a_b_cc&#39;</span><span class="p">),</span> <span class="s1">&#39;ABCc&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">class2attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cls_name</span><span class="p">):</span>
    <span class="s2">&quot;Return the snake-cased name of the class; strip ending `cls_name` if it exists.&quot;</span>
    <span class="k">return</span> <span class="n">camel2snake</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">rf</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">cls_name</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span> <span class="ow">or</span> <span class="n">cls_name</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Parent</span><span class="p">:</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="n">class2attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Parent&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">ChildOfParent</span><span class="p">(</span><span class="n">Parent</span><span class="p">):</span> <span class="k">pass</span>
<span class="k">class</span> <span class="nc">ParentChildOf</span><span class="p">(</span><span class="n">Parent</span><span class="p">):</span> <span class="k">pass</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">Parent</span><span class="p">()</span>
<span class="n">cp</span> <span class="o">=</span> <span class="n">ChildOfParent</span><span class="p">()</span>
<span class="n">cp2</span> <span class="o">=</span> <span class="n">ParentChildOf</span><span class="p">()</span>

<span class="n">test_eq</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;parent&#39;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;child_of&#39;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">cp2</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;parent_child_of&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">getattrs</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="o">*</span><span class="n">attrs</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="s2">&quot;List of all `attrs` in `o`&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span><span class="n">attr</span><span class="p">,</span><span class="n">default</span><span class="p">)</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">fractions</span> <span class="kn">import</span> <span class="n">Fraction</span>
<span class="n">getattrs</span><span class="p">(</span><span class="n">Fraction</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;numerator&#39;</span><span class="p">,</span> <span class="s1">&#39;denominator&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1, 2]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">hasattrs</span><span class="p">(</span><span class="n">o</span><span class="p">,</span><span class="n">attrs</span><span class="p">):</span>
    <span class="s2">&quot;Test whether `o` contains all `attrs`&quot;</span>
    <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">hasattrs</span><span class="p">(</span><span class="mi">1</span><span class="p">,(</span><span class="s1">&#39;imag&#39;</span><span class="p">,</span><span class="s1">&#39;real&#39;</span><span class="p">))</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">hasattrs</span><span class="p">(</span><span class="mi">1</span><span class="p">,(</span><span class="s1">&#39;imag&#39;</span><span class="p">,</span><span class="s1">&#39;foo&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">setattrs</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="n">flds</span><span class="p">,</span> <span class="n">src</span><span class="p">):</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">get</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="nb">getattr</span>
    <span class="n">flds</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;,\s*&quot;</span><span class="p">,</span> <span class="n">flds</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">fld</span> <span class="ow">in</span> <span class="n">flds</span><span class="p">:</span> <span class="nb">setattr</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="n">fld</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">fld</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">bb</span><span class="o">=</span><span class="s2">&quot;2&quot;</span><span class="p">,</span><span class="n">ignore</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">o</span> <span class="o">=</span> <span class="n">SimpleNamespace</span><span class="p">()</span>
<span class="n">setattrs</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="s2">&quot;a,bb&quot;</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">bb</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="n">SimpleNamespace</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">bb</span><span class="o">=</span><span class="s2">&quot;2&quot;</span><span class="p">,</span><span class="n">ignore</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">o</span> <span class="o">=</span> <span class="n">SimpleNamespace</span><span class="p">()</span>
<span class="n">setattrs</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="s2">&quot;a,bb&quot;</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">bb</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">try_attrs</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">*</span><span class="n">attrs</span><span class="p">):</span>
    <span class="s2">&quot;Return first attr that exists in `obj`&quot;</span>
    <span class="k">for</span> <span class="n">att</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span> <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">att</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
    <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">try_attrs</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;real&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">try_attrs</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;foobar&#39;</span><span class="p">,</span> <span class="s1">&#39;real&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="attribute-delegation">
<h2>Attribute Delegation<a class="headerlink" href="#attribute-delegation" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">class</span> <span class="nc">GetAttrBase</span><span class="p">:</span>
    <span class="s2">&quot;Basic delegation of `__getattr__` and `__dir__`&quot;</span>
    <span class="n">_attr</span><span class="o">=</span><span class="n">noop</span>
    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">k</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;_&#39;</span> <span class="ow">or</span> <span class="n">k</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">_attr</span><span class="p">:</span> <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__getattr__</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getattr</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attr</span><span class="p">)[</span><span class="n">k</span><span class="p">])</span>
    <span class="k">def</span> <span class="fm">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="n">custom_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attr</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">class</span> <span class="nc">GetAttr</span><span class="p">:</span>
    <span class="s2">&quot;Inherit from this to have all attr accesses in `self._xtra` passed down to `self.default`&quot;</span>
    <span class="n">_default</span><span class="o">=</span><span class="s1">&#39;default&#39;</span>
    <span class="k">def</span> <span class="nf">_component_attr_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">k</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;__&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;_xtra&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_default</span><span class="p">):</span> <span class="k">return</span> <span class="kc">False</span>
        <span class="n">xtra</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_xtra&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">xtra</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">xtra</span>
    <span class="k">def</span> <span class="nf">_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_default</span><span class="p">))</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_component_attr_filter</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span>
    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">k</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_component_attr_filter</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_default</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">attr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span><span class="n">k</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__dir__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="n">custom_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_dir</span><span class="p">())</span>
<span class="c1">#     def __getstate__(self): return self.__dict__</span>
    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">show_doc</span><span class="p">(</span><span class="n">GetAttr</span><span class="p">,</span> <span class="n">title_level</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<h4 id="GetAttr" class="doc_header"><code>class</code> <code>GetAttr</code><a href="" class="source_link" style="float:right">[source]</a></h4>
<blockquote>
<div><p><code>GetAttr</code>()</p>
</div></blockquote>
<p>Inherit from this to have all attr accesses in <code class="docutils literal notranslate"><span class="pre">self._xtra</span></code> passed down to <code class="docutils literal notranslate"><span class="pre">self.default</span></code></p>
</div>
</div>
<p>Inherit from <code class="docutils literal notranslate"><span class="pre">GetAttr</span></code> to have attr access passed down to an instance attribute.
This makes it easy to create composites that don’t require callers to know about their components.  For a more detailed discussion of how this works as well as relevant context, we suggest reading the <a class="reference external" href="https://www.fast.ai/2019/08/06/delegation/">delegated composition section of this blog article</a>.</p>
<p>You can customise the behaviour of <code class="docutils literal notranslate"><span class="pre">GetAttr</span></code> in subclasses via;</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">_default</span></code></p>
<ul>
<li><p>By default, this is set to <code class="docutils literal notranslate"><span class="pre">'default'</span></code>, so attr access is passed down to <code class="docutils literal notranslate"><span class="pre">self.default</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">_default</span></code> can be set to the name of any instance attribute that does not start with dunder <code class="docutils literal notranslate"><span class="pre">__</span></code></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">_xtra</span></code></p>
<ul>
<li><p>By default, this is <code class="docutils literal notranslate"><span class="pre">None</span></code>, so all attr access is passed down</p></li>
<li><p>You can limit which attrs get passed down by setting <code class="docutils literal notranslate"><span class="pre">_xtra</span></code> to a list of attribute names</p></li>
</ul>
</li>
</ul>
<p>To illuminate the utility of <code class="docutils literal notranslate"><span class="pre">GetAttr</span></code>, suppose we have the following two classes, <code class="docutils literal notranslate"><span class="pre">_WebPage</span></code> which is a superclass of <code class="docutils literal notranslate"><span class="pre">_ProductPage</span></code>, which we wish to compose like so:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">_WebPage</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">author</span><span class="o">=</span><span class="s2">&quot;Jeremy&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">title</span><span class="p">,</span><span class="n">author</span>

<span class="k">class</span> <span class="nc">_ProductPage</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">page</span><span class="p">,</span> <span class="n">price</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">page</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">price</span> <span class="o">=</span> <span class="n">page</span><span class="p">,</span><span class="n">price</span>
        
<span class="n">page</span> <span class="o">=</span> <span class="n">_WebPage</span><span class="p">(</span><span class="s1">&#39;Soap&#39;</span><span class="p">,</span> <span class="n">author</span><span class="o">=</span><span class="s2">&quot;Sylvain&quot;</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">_ProductPage</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="mf">15.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>How do we make it so we can just write <code class="docutils literal notranslate"><span class="pre">p.author</span></code>, instead of <code class="docutils literal notranslate"><span class="pre">p.page.author</span></code> to access the <code class="docutils literal notranslate"><span class="pre">author</span></code> attribute?  We can use <code class="docutils literal notranslate"><span class="pre">GetAttr</span></code>, of course!  First, we subclass <code class="docutils literal notranslate"><span class="pre">GetAttr</span></code> when defining <code class="docutils literal notranslate"><span class="pre">_ProductPage</span></code>.  Next, we set <code class="docutils literal notranslate"><span class="pre">self.default</span></code> to the object whose attributes we want to be able to access directly, which in this case is the <code class="docutils literal notranslate"><span class="pre">page</span></code> argument passed on initialization:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">_ProductPage</span><span class="p">(</span><span class="n">GetAttr</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">page</span><span class="p">,</span> <span class="n">price</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">price</span> <span class="o">=</span> <span class="n">page</span><span class="p">,</span><span class="n">price</span> <span class="c1">#self.default allows you to access page directly.</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">_ProductPage</span><span class="p">(</span><span class="n">page</span><span class="p">,</span> <span class="mf">15.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now, we can access the <code class="docutils literal notranslate"><span class="pre">author</span></code> attribute directly from the instance:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">author</span><span class="p">,</span> <span class="s1">&#39;Sylvain&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>If you wish to store the object you are composing in an attribute other than <code class="docutils literal notranslate"><span class="pre">self.default</span></code>, you can set the class attribute <code class="docutils literal notranslate"><span class="pre">_data</span></code> as shown below.  This is useful in the case where you might have a name collision with <code class="docutils literal notranslate"><span class="pre">self.default</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">_C</span><span class="p">(</span><span class="n">GetAttr</span><span class="p">):</span>
    <span class="n">_default</span> <span class="o">=</span> <span class="s1">&#39;_data&#39;</span> <span class="c1"># use different component name; `self._data` rather than `self.default`</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">a</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">a</span>
    <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="n">noop</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">_C</span><span class="p">(</span><span class="s1">&#39;Hi&#39;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="s1">&#39;Hi&#39;</span><span class="p">)</span> 
<span class="n">test_fail</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">default</span><span class="p">)</span> <span class="c1"># we no longer have self.default</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="s1">&#39;hi&#39;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="s1">&#39;HI&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="s1">&#39;lower&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="k">assert</span> <span class="s1">&#39;upper&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>By default, all attributes and methods of the object you are composing are retained. In the below example, we compose a <code class="docutils literal notranslate"><span class="pre">str</span></code> object with the class <code class="docutils literal notranslate"><span class="pre">_C</span></code>. This allows us to directly call string methods on instances of class <code class="docutils literal notranslate"><span class="pre">_C</span></code>, such as <code class="docutils literal notranslate"><span class="pre">str.lower()</span></code> or <code class="docutils literal notranslate"><span class="pre">str.upper()</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">_C</span><span class="p">(</span><span class="n">GetAttr</span><span class="p">):</span>
    <span class="c1"># allow all attributes and methods to get passed to `self.default` (by leaving _xtra=None)</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">a</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="n">a</span>
    <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="n">noop</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">_C</span><span class="p">(</span><span class="s1">&#39;Hi&#39;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="s1">&#39;hi&#39;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="s1">&#39;HI&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="s1">&#39;lower&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="k">assert</span> <span class="s1">&#39;upper&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>However, you can choose which attributes or methods to retain by defining a class attribute <code class="docutils literal notranslate"><span class="pre">_xtra</span></code>, which is a list of allowed attribute and method names to delegate.  In the below example, we only delegate the <code class="docutils literal notranslate"><span class="pre">lower</span></code> method from the composed <code class="docutils literal notranslate"><span class="pre">str</span></code> object when defining class <code class="docutils literal notranslate"><span class="pre">_C</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">_C</span><span class="p">(</span><span class="n">GetAttr</span><span class="p">):</span>
    <span class="n">_xtra</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;lower&#39;</span><span class="p">]</span> <span class="c1"># specify which attributes get passed to `self.default`</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">a</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="n">a</span>
    <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="n">noop</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">_C</span><span class="p">(</span><span class="s1">&#39;Hi&#39;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">default</span><span class="p">,</span> <span class="s1">&#39;Hi&#39;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="s1">&#39;hi&#39;</span><span class="p">)</span>
<span class="n">test_fail</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span> <span class="c1"># upper wasn&#39;t in _xtra, so it isn&#39;t available to be called</span>
<span class="k">assert</span> <span class="s1">&#39;lower&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="k">assert</span> <span class="s1">&#39;upper&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>You must be careful to properly set an instance attribute in <code class="docutils literal notranslate"><span class="pre">__init__</span></code> that corresponds to the class attribute <code class="docutils literal notranslate"><span class="pre">_default</span></code>.  The below example sets the class attribute <code class="docutils literal notranslate"><span class="pre">_default</span></code> to <code class="docutils literal notranslate"><span class="pre">data</span></code>, but erroneously fails to define <code class="docutils literal notranslate"><span class="pre">self.data</span></code> (and instead defines <code class="docutils literal notranslate"><span class="pre">self.default</span></code>).</p>
<p>Failing to properly set instance attributes leads to errors when you try to access methods directly:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">_C</span><span class="p">(</span><span class="n">GetAttr</span><span class="p">):</span>
    <span class="n">_default</span> <span class="o">=</span> <span class="s1">&#39;data&#39;</span> <span class="c1"># use a bad component name; i.e. self.data does not exist</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">a</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="n">a</span>
    <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="n">noop</span>
        
<span class="c1"># TODO: should we raise an error when we create a new instance ...</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">_C</span><span class="p">(</span><span class="s1">&#39;Hi&#39;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">default</span><span class="p">,</span> <span class="s1">&#39;Hi&#39;</span><span class="p">)</span>
<span class="c1"># ... or is it enough for all GetAttr features to raise errors</span>
<span class="n">test_fail</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="n">test_fail</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
<span class="n">test_fail</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
<span class="n">test_fail</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">dir</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#hide</span>
<span class="c1"># I don&#39;t think this test is essential to the docs but it probably makes sense to</span>
<span class="c1"># check that everything works when we set both _xtra and _default to non-default values</span>
<span class="k">class</span> <span class="nc">_C</span><span class="p">(</span><span class="n">GetAttr</span><span class="p">):</span>
    <span class="n">_xtra</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="s1">&#39;upper&#39;</span><span class="p">]</span>
    <span class="n">_default</span> <span class="o">=</span> <span class="s1">&#39;data&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">a</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">a</span>
    <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="n">noop</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">_C</span><span class="p">(</span><span class="s1">&#39;Hi&#39;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;Hi&#39;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="s1">&#39;hi&#39;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="s1">&#39;HI&#39;</span><span class="p">)</span>
<span class="k">assert</span> <span class="s1">&#39;lower&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="k">assert</span> <span class="s1">&#39;upper&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#hide</span>
<span class="c1">#  when consolidating the filter logic, I choose the previous logic from </span>
<span class="c1"># __getattr__  k.startswith(&#39;__&#39;) rather than</span>
<span class="c1"># _dir         k.startswith(&#39;_&#39;). </span>
<span class="k">class</span> <span class="nc">_C</span><span class="p">(</span><span class="n">GetAttr</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="s1">&#39;_D&#39;</span><span class="p">,</span> <span class="p">(),</span> <span class="p">{</span><span class="s1">&#39;_under&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;__dunder&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">})()</span> 
    
<span class="n">t</span> <span class="o">=</span> <span class="n">_C</span><span class="p">()</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">default</span><span class="o">.</span><span class="n">_under</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">_under</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>           <span class="c1"># _ prefix attr access is allowed on component</span>
<span class="k">assert</span> <span class="s1">&#39;_under&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">default</span><span class="o">.</span><span class="n">__dunder</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">test_fail</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">__dunder</span><span class="p">)</span>  <span class="c1"># __ prefix attr access is not allowed on component</span>
<span class="k">assert</span> <span class="s1">&#39;__dunder&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">t</span><span class="o">.</span><span class="fm">__dir__</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>   <span class="c1"># __ prefix attr access is allowed on composite</span>
<span class="k">assert</span> <span class="s1">&#39;__dir__&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#hide</span>
<span class="c1">#Failing test. TODO: make GetAttr pickle-safe</span>

<span class="c1"># class B:</span>
<span class="c1">#     def __init__(self): self.a = A()</span>

<span class="c1"># @funcs_kwargs</span>
<span class="c1"># class A(GetAttr):</span>
<span class="c1">#     wif=after_iter= noops</span>
<span class="c1">#     _methods = &#39;wif after_iter&#39;.split()</span>
<span class="c1">#     _default = &#39;dataset&#39;</span>
<span class="c1">#     def __init__(self, **kwargs): pass</span>
    
<span class="c1"># a = A()</span>
<span class="c1"># b = A(wif=a.wif)</span>
        
<span class="c1"># a = A()</span>
<span class="c1"># b = A(wif=a.wif)</span>
<span class="c1"># tst = pickle.dumps(b)</span>
<span class="c1"># c = pickle.loads(tst)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">delegate_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">to</span><span class="p">):</span>
    <span class="s2">&quot;Use in `__getattr__` to delegate to attr `to` without inheriting from `GetAttr`&quot;</span>
    <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">k</span><span class="o">==</span><span class="n">to</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span> <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">to</span><span class="p">),</span> <span class="n">k</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="kn">from</span> <span class="bp">None</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">delegate_attr</span></code> is a functional way to delegate attributes, and is an alternative to <code class="docutils literal notranslate"><span class="pre">GetAttr</span></code>.  We recommend reading the documentation of <code class="docutils literal notranslate"><span class="pre">GetAttr</span></code> for more details around delegation.</p>
<p>You can use achieve delegation when you define <code class="docutils literal notranslate"><span class="pre">__getattr__</span></code> by using <code class="docutils literal notranslate"><span class="pre">delegate_attr</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#hide</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">_C</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">o</span> <span class="o">=</span> <span class="n">o</span> <span class="c1"># self.o corresponds to the `to` argument in delegate_attr.</span>
    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span> <span class="k">return</span> <span class="n">delegate_attr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">to</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
    

<span class="n">t</span> <span class="o">=</span> <span class="n">_C</span><span class="p">(</span><span class="s1">&#39;HELLO&#39;</span><span class="p">)</span> <span class="c1"># delegates to a string</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="s1">&#39;hello&#39;</span><span class="p">)</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">_C</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">]))</span> <span class="c1"># delegates to a numpy array</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mi">12</span><span class="p">)</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">_C</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]}))</span> <span class="c1"># delegates to a pandas.DataFrame</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="extensible-types">
<h2>Extensible Types<a class="headerlink" href="#extensible-types" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">ShowPrint</span></code> is a base class that defines a <code class="docutils literal notranslate"><span class="pre">show</span></code> method, which is used primarily for callbacks in fastai that expect this method to be defined.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="c1">#hide</span>
<span class="k">class</span> <span class="nc">ShowPrint</span><span class="p">:</span>
    <span class="s2">&quot;Base class that prints for `show`&quot;</span>
    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Int</span></code>, <code class="docutils literal notranslate"><span class="pre">Float</span></code>, and <code class="docutils literal notranslate"><span class="pre">Str</span></code> extend <code class="docutils literal notranslate"><span class="pre">int</span></code>, <code class="docutils literal notranslate"><span class="pre">float</span></code> and <code class="docutils literal notranslate"><span class="pre">str</span></code> respectively by adding an additional <code class="docutils literal notranslate"><span class="pre">show</span></code> method by inheriting from <code class="docutils literal notranslate"><span class="pre">ShowPrint</span></code>.</p>
<p>The code for <code class="docutils literal notranslate"><span class="pre">Int</span></code> is shown below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="c1">#hide</span>
<span class="k">class</span> <span class="nc">Int</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="n">ShowPrint</span><span class="p">):</span>
    <span class="s2">&quot;An extensible `int`&quot;</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export </span>
<span class="c1">#hide</span>
<span class="k">class</span> <span class="nc">Str</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="n">ShowPrint</span><span class="p">):</span>
    <span class="s2">&quot;An extensible `str`&quot;</span>
    <span class="k">pass</span>
<span class="k">class</span> <span class="nc">Float</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="n">ShowPrint</span><span class="p">):</span>
    <span class="s2">&quot;An extensible `float`&quot;</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
</div>
<p>Examples:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Int</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">Float</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">Str</span><span class="p">(</span><span class="s1">&#39;Hello&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0
2.0
Hello
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="collection-functions">
<h2>Collection functions<a class="headerlink" href="#collection-functions" title="Permalink to this headline">¶</a></h2>
<p>Functions that manipulate popular python collections.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">concat</span><span class="p">(</span><span class="n">colls</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">list</span><span class="p">:</span>
    <span class="s2">&quot;Concatenate all collections in `colls`&quot;</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">from_iterable</span><span class="p">(</span><span class="n">colls</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">concat</span><span class="p">([(</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)),[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0, 1, 2, 3, 4]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">strcat</span><span class="p">(</span><span class="n">its</span><span class="p">,</span> <span class="n">sep</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">str</span><span class="p">:</span>
    <span class="s2">&quot;Concatenate stringified items `its`&quot;</span>
    <span class="k">return</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="n">its</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">strcat</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">]),</span> <span class="s1">&#39;a2&#39;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">strcat</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;;&#39;</span><span class="p">),</span> <span class="s1">&#39;a;2&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">detuplify</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="s2">&quot;If `x` is a tuple with one thing, extract it&quot;</span>
    <span class="k">return</span> <span class="kc">None</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span> <span class="k">else</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;ndim&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span> <span class="k">else</span> <span class="n">x</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">detuplify</span><span class="p">(()),</span><span class="kc">None</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">detuplify</span><span class="p">([</span><span class="mi">1</span><span class="p">]),</span><span class="mi">1</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">detuplify</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]),</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">detuplify</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]])),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]]))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">replicate</span><span class="p">(</span><span class="n">item</span><span class="p">,</span><span class="n">match</span><span class="p">):</span>
    <span class="s2">&quot;Create tuple of `item` copied `len(match)` times&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">item</span><span class="p">,)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">replicate</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">t</span><span class="p">),([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">replicate</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">t</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># export</span>
<span class="k">def</span> <span class="nf">setify</span><span class="p">(</span><span class="n">o</span><span class="p">):</span> 
    <span class="s2">&quot;Turn any list like-object into a set.&quot;</span>
    <span class="k">return</span> <span class="n">o</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span><span class="nb">set</span><span class="p">)</span> <span class="k">else</span> <span class="nb">set</span><span class="p">(</span><span class="n">listify</span><span class="p">(</span><span class="n">o</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># test</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">setify</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span><span class="nb">set</span><span class="p">())</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">setify</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">),{</span><span class="s1">&#39;abc&#39;</span><span class="p">})</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">setify</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]),{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">})</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">setify</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">)),{</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">})</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">setify</span><span class="p">({</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">}),{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="o">*</span><span class="n">ds</span><span class="p">):</span>
    <span class="s2">&quot;Merge all dictionaries in `ds`&quot;</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">ds</span> <span class="k">if</span> <span class="n">d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">merge</span><span class="p">(),</span> <span class="p">{})</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">merge</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span> <span class="nb">dict</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">merge</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="nb">dict</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span> <span class="kc">None</span><span class="p">),</span> <span class="nb">dict</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">range_of</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="s2">&quot;All indices of collection `x` (i.e. `list(range(len(x)))`)&quot;</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">range_of</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">groupby</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">noop</span><span class="p">):</span>
    <span class="s2">&quot;Like `itertools.groupby` but doesn&#39;t need to be sorted, and isn&#39;t lazy, plus some extensions&quot;</span>
    <span class="k">if</span>   <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="nb">int</span><span class="p">):</span> <span class="n">key</span> <span class="o">=</span> <span class="n">itemgetter</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span> <span class="n">key</span> <span class="o">=</span> <span class="n">attrgetter</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="k">if</span>   <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="nb">int</span><span class="p">):</span> <span class="n">val</span> <span class="o">=</span> <span class="n">itemgetter</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span> <span class="n">val</span> <span class="o">=</span> <span class="n">attrgetter</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span> <span class="n">res</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">key</span><span class="p">(</span><span class="n">o</span><span class="p">),</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">(</span><span class="n">o</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">res</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;aa ab bb&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span> <span class="n">itemgetter</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:[</span><span class="s1">&#39;aa&#39;</span><span class="p">,</span><span class="s1">&#39;ab&#39;</span><span class="p">],</span> <span class="s1">&#39;b&#39;</span><span class="p">:[</span><span class="s1">&#39;bb&#39;</span><span class="p">]})</span>
</pre></div>
</div>
</div>
</div>
<p>Here’s an example of how to <em>invert</em> a grouping, using an <code class="docutils literal notranslate"><span class="pre">int</span></code> as <code class="docutils literal notranslate"><span class="pre">key</span></code> (which uses <code class="docutils literal notranslate"><span class="pre">itemgetter</span></code>; passing a <code class="docutils literal notranslate"><span class="pre">str</span></code> will use <code class="docutils literal notranslate"><span class="pre">attrgetter</span></code>), and using a <code class="docutils literal notranslate"><span class="pre">val</span></code> function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> <span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="mi">3</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="mi">4</span><span class="p">:</span> <span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="mi">5</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="mi">7</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">]}</span>
<span class="n">groupby</span><span class="p">(((</span><span class="n">o</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">v</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{1: [0], 3: [0, 2], 7: [0], 5: [3, 7], 8: [4], 4: [5]}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">last_index</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
    <span class="s2">&quot;Finds the last index of occurence of `x` in `o` (returns -1 if no occurence)&quot;</span>
    <span class="k">try</span><span class="p">:</span> <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">o</span><span class="p">)))</span> <span class="k">if</span> <span class="n">o</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">last_index</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">]),</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">last_index</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">]),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">filter_dict</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
    <span class="s2">&quot;Filter a `dict` using `func`, applied to keys and values&quot;</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">func</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">letters</span> <span class="o">=</span> <span class="p">{</span><span class="n">o</span><span class="p">:</span><span class="nb">chr</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">65</span><span class="p">,</span><span class="mi">73</span><span class="p">)}</span>
<span class="n">letters</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{65: &#39;A&#39;, 66: &#39;B&#39;, 67: &#39;C&#39;, 68: &#39;D&#39;, 69: &#39;E&#39;, 70: &#39;F&#39;, 71: &#39;G&#39;, 72: &#39;H&#39;}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">filter_dict</span><span class="p">(</span><span class="n">letters</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">:</span> <span class="n">k</span><span class="o">&lt;</span><span class="mi">67</span> <span class="ow">or</span> <span class="n">v</span> <span class="ow">in</span> <span class="s1">&#39;FG&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{65: &#39;A&#39;, 66: &#39;B&#39;, 70: &#39;F&#39;, 71: &#39;G&#39;}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">filter_keys</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
    <span class="s2">&quot;Filter a `dict` using `func`, applied to keys&quot;</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">func</span><span class="p">(</span><span class="n">k</span><span class="p">)}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">filter_keys</span><span class="p">(</span><span class="n">letters</span><span class="p">,</span> <span class="n">lt</span><span class="p">(</span><span class="mi">67</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{65: &#39;A&#39;, 66: &#39;B&#39;}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">filter_values</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
    <span class="s2">&quot;Filter a `dict` using `func`, applied to values&quot;</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">func</span><span class="p">(</span><span class="n">v</span><span class="p">)}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">filter_values</span><span class="p">(</span><span class="n">letters</span><span class="p">,</span> <span class="n">in_</span><span class="p">(</span><span class="s1">&#39;FG&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{70: &#39;F&#39;, 71: &#39;G&#39;}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">cycle</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
    <span class="s2">&quot;Like `itertools.cycle` except creates list of `None`s if `o` is empty&quot;</span>
    <span class="n">o</span> <span class="o">=</span> <span class="n">listify</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">itertools</span><span class="o">.</span><span class="n">cycle</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">if</span> <span class="n">o</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">itertools</span><span class="o">.</span><span class="n">cycle</span><span class="p">([</span><span class="kc">None</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">islice</span><span class="p">(</span><span class="n">cycle</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]),</span><span class="mi">5</span><span class="p">),</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">islice</span><span class="p">(</span><span class="n">cycle</span><span class="p">([]),</span><span class="mi">3</span><span class="p">),</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">islice</span><span class="p">(</span><span class="n">cycle</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span><span class="mi">3</span><span class="p">),</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">islice</span><span class="p">(</span><span class="n">cycle</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="mi">3</span><span class="p">),</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">zip_cycle</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="s2">&quot;Like `itertools.zip_longest` but `cycle`s through elements of all but first argument&quot;</span>
    <span class="k">return</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="nb">map</span><span class="p">(</span><span class="n">cycle</span><span class="p">,</span><span class="n">args</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">zip_cycle</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span><span class="nb">list</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">)),</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">sorted_ex</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="s2">&quot;Like `sorted`, but if key is str use `attrgetter`; if int use `itemgetter`&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>   <span class="n">k</span><span class="o">=</span><span class="k">lambda</span> <span class="n">o</span><span class="p">:</span><span class="nb">getattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="nb">int</span><span class="p">):</span> <span class="n">k</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> <span class="n">k</span><span class="o">=</span><span class="n">key</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="n">reverse</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">not_</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="s2">&quot;Create new function that negates result of `f`&quot;</span>
    <span class="k">def</span> <span class="nf">_f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> <span class="k">return</span> <span class="ow">not</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_f</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">):</span> <span class="k">return</span> <span class="n">a</span><span class="o">&gt;</span><span class="mi">0</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="kc">True</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">not_</span><span class="p">(</span><span class="n">f</span><span class="p">)(</span><span class="mi">1</span><span class="p">),</span><span class="kc">False</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">not_</span><span class="p">(</span><span class="n">f</span><span class="p">)(</span><span class="n">a</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">argwhere</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">negate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="s2">&quot;Like `filter_ex`, but return indices for matching items&quot;</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">f</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">negate</span><span class="p">:</span> <span class="n">f</span> <span class="o">=</span> <span class="n">not_</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">o</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">iterable</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="p">(</span><span class="n">o</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">filter_ex</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">noop</span><span class="p">,</span> <span class="n">negate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">gen</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="s2">&quot;Like `filter`, but passing `kwargs` to `f`, defaulting `f` to `noop`, and adding `negate` and `gen`&quot;</span>
    <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span> <span class="n">f</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">negate</span><span class="p">:</span> <span class="n">f</span> <span class="o">=</span> <span class="n">not_</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">iterable</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gen</span><span class="p">:</span> <span class="k">return</span> <span class="n">res</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">range_of</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="s2">&quot;All indices of collection `a`, if `a` is a collection, otherwise `range`&quot;</span>
    <span class="k">if</span> <span class="n">is_coll</span><span class="p">(</span><span class="n">a</span><span class="p">):</span> <span class="n">a</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">step</span><span class="p">)</span> <span class="k">if</span> <span class="n">step</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="k">if</span> <span class="n">b</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">range_of</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">range_of</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">renumerate</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="s2">&quot;Same as `enumerate`, but returns index as 2nd element instead of 1st&quot;</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">o</span><span class="p">,</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">o</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">renumerate</span><span class="p">(</span><span class="s1">&#39;abc&#39;</span><span class="p">),</span> <span class="p">((</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">first</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">negate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="s2">&quot;First element of `x`, optionally filtered by `f`, or None if missing&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">f</span><span class="p">:</span> <span class="n">x</span> <span class="o">=</span> <span class="n">filter_ex</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">negate</span><span class="o">=</span><span class="n">negate</span><span class="p">,</span> <span class="n">gen</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">first</span><span class="p">([</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">]),</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">first</span><span class="p">([</span><span class="kc">False</span><span class="p">]),</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">first</span><span class="p">([</span><span class="kc">False</span><span class="p">],</span> <span class="n">noop</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">nested_attr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="s2">&quot;Same as `getattr`, but if `attr` includes a `.`, then looks inside nested objects&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">attr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">):</span> <span class="n">o</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span> <span class="k">return</span> <span class="n">default</span>
    <span class="k">return</span> <span class="n">o</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">SimpleNamespace</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="p">(</span><span class="n">SimpleNamespace</span><span class="p">(</span><span class="n">c</span><span class="o">=</span><span class="mi">1</span><span class="p">)))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">nested_attr</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s1">&#39;b.c&#39;</span><span class="p">),</span> <span class="nb">getattr</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">),</span> <span class="s1">&#39;c&#39;</span><span class="p">))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">nested_attr</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s1">&#39;b.d&#39;</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">nested_idx</span><span class="p">(</span><span class="n">coll</span><span class="p">,</span> <span class="o">*</span><span class="n">idxs</span><span class="p">):</span>
    <span class="s2">&quot;Index into nested collections, dicts, etc, with `idxs`&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">coll</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">idxs</span><span class="p">:</span> <span class="k">return</span> <span class="n">coll</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">coll</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">coll</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Collection</span><span class="p">):</span> <span class="k">return</span> <span class="kc">None</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">coll</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">idxs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">coll</span><span class="p">,</span> <span class="s1">&#39;get&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">coll</span><span class="p">[</span><span class="n">idxs</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="k">if</span> <span class="n">idxs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">coll</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">nested_idx</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="o">*</span><span class="n">idxs</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:[</span><span class="mi">1</span><span class="p">,{</span><span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">}]}</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">nested_idx</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">a</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">nested_idx</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">),</span> <span class="p">[</span><span class="mi">1</span><span class="p">,{</span><span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">}])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">nested_idx</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;c&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">})</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">nested_idx</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">val2idx</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="s2">&quot;Dict from value to index&quot;</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">x</span><span class="p">)}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">val2idx</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]),</span> <span class="p">{</span><span class="mi">3</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">uniqueify</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bidir</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="s2">&quot;Unique elements in `x`, optionally `sort`-ed, optionally return reverse correspondence, optionally prepend with elements.&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">res</span> <span class="o">=</span> <span class="n">listify</span><span class="p">(</span><span class="n">start</span><span class="p">)</span><span class="o">+</span><span class="n">res</span>
    <span class="k">if</span> <span class="n">sort</span><span class="p">:</span> <span class="n">res</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="n">val2idx</span><span class="p">(</span><span class="n">res</span><span class="p">))</span> <span class="k">if</span> <span class="n">bidir</span> <span class="k">else</span> <span class="n">res</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">uniqueify</span><span class="p">(</span><span class="n">t</span><span class="p">),[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">uniqueify</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">),[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">uniqueify</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">]),</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
<span class="n">v</span><span class="p">,</span><span class="n">o</span> <span class="o">=</span> <span class="n">uniqueify</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">bidir</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">v</span><span class="p">,[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">o</span><span class="p">,{</span><span class="mi">1</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span>
<span class="n">v</span><span class="p">,</span><span class="n">o</span> <span class="o">=</span> <span class="n">uniqueify</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bidir</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">v</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">o</span><span class="p">,{</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="fastuple">
<h2>fastuple<a class="headerlink" href="#fastuple" title="Permalink to this headline">¶</a></h2>
<p>A tuple with extended functionality.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="n">num_methods</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    __add__ __sub__ __mul__ __matmul__ __truediv__ __floordiv__ __mod__ __divmod__ __pow__</span>
<span class="s2">    __lshift__ __rshift__ __and__ __xor__ __or__ __neg__ __pos__ __abs__</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="n">rnum_methods</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    __radd__ __rsub__ __rmul__ __rmatmul__ __rtruediv__ __rfloordiv__ __rmod__ __rdivmod__</span>
<span class="s2">    __rpow__ __rlshift__ __rrshift__ __rand__ __rxor__ __ror__</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="n">inum_methods</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    __iadd__ __isub__ __imul__ __imatmul__ __itruediv__</span>
<span class="s2">    __ifloordiv__ __imod__ __ipow__ __ilshift__ __irshift__ __iand__ __ixor__ __ior__</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">class</span> <span class="nc">fastuple</span><span class="p">(</span><span class="nb">tuple</span><span class="p">):</span>
    <span class="s2">&quot;A `tuple` with elementwise ops and more friendly __init__ behavior&quot;</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">rest</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">x</span> <span class="o">=</span> <span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="nb">tuple</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rest</span><span class="p">):</span> <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span> <span class="n">x</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span> <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">x</span><span class="o">+</span><span class="n">rest</span> <span class="k">if</span> <span class="n">rest</span> <span class="k">else</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">op</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fastuple</span><span class="p">):</span> <span class="bp">self</span> <span class="o">=</span> <span class="n">fastuple</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="nb">map</span><span class="p">(</span><span class="n">op</span><span class="p">,</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="nb">map</span><span class="p">(</span><span class="n">cycle</span><span class="p">,</span> <span class="n">args</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">mul</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="s2">&quot;`*` is already defined in `tuple` for replicating, so use `mul` instead&quot;</span>
        <span class="k">return</span> <span class="n">fastuple</span><span class="o">.</span><span class="n">_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">mul</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="s2">&quot;`+` is already defined in `tuple` for concat, so use `add` instead&quot;</span>
        <span class="k">return</span> <span class="n">fastuple</span><span class="o">.</span><span class="n">_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_get_op</span><span class="p">(</span><span class="n">op</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">op</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span> <span class="n">op</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">operator</span><span class="p">,</span><span class="n">op</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_op</span><span class="p">(</span><span class="n">op</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">_f</span>

<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">num_methods</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">fastuple</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">operator</span><span class="p">,</span><span class="n">n</span><span class="p">):</span> <span class="nb">setattr</span><span class="p">(</span><span class="n">fastuple</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">_get_op</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>

<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="s1">&#39;eq ne lt le gt ge&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">():</span> <span class="nb">setattr</span><span class="p">(</span><span class="n">fastuple</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">_get_op</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<span class="nb">setattr</span><span class="p">(</span><span class="n">fastuple</span><span class="p">,</span><span class="s1">&#39;__invert__&#39;</span><span class="p">,</span><span class="n">_get_op</span><span class="p">(</span><span class="s1">&#39;__not__&#39;</span><span class="p">))</span>
<span class="nb">setattr</span><span class="p">(</span><span class="n">fastuple</span><span class="p">,</span><span class="s1">&#39;max&#39;</span><span class="p">,</span><span class="n">_get_op</span><span class="p">(</span><span class="nb">max</span><span class="p">))</span>
<span class="nb">setattr</span><span class="p">(</span><span class="n">fastuple</span><span class="p">,</span><span class="s1">&#39;min&#39;</span><span class="p">,</span><span class="n">_get_op</span><span class="p">(</span><span class="nb">min</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">show_doc</span><span class="p">(</span><span class="n">fastuple</span><span class="p">,</span> <span class="n">title_level</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<h4 id="fastuple" class="doc_header"><code>class</code> <code>fastuple</code><a href="" class="source_link" style="float:right">[source]</a></h4>
<blockquote>
<div><p><code>fastuple</code>(<strong><code class="docutils literal notranslate"><span class="pre">x</span></code></strong>=<em><code class="docutils literal notranslate"><span class="pre">None</span></code></em>, <strong>*<code class="docutils literal notranslate"><span class="pre">rest</span></code></strong>) :: <code class="docutils literal notranslate"><span class="pre">tuple</span></code></p>
</div></blockquote>
<p>A <code class="docutils literal notranslate"><span class="pre">tuple</span></code> with elementwise ops and more friendly <strong>init</strong> behavior</p>
</div>
</div>
<div class="section" id="friendly-init-behavior">
<h3>Friendly init behavior<a class="headerlink" href="#friendly-init-behavior" title="Permalink to this headline">¶</a></h3>
<p>Common failure modes when trying to initialize a tuple in python:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="nb">tuple</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="ne">TypeError</span><span class="p">:</span> <span class="s1">&#39;int&#39;</span> <span class="nb">object</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">iterable</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="nb">tuple</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="ne">TypeError</span><span class="p">:</span> <span class="nb">tuple</span> <span class="n">expected</span> <span class="n">at</span> <span class="n">most</span> <span class="mi">1</span> <span class="n">arguments</span><span class="p">,</span> <span class="n">got</span> <span class="mi">2</span>
</pre></div>
</div>
<p>However, <code class="docutils literal notranslate"><span class="pre">fastuple</span></code> allows you to define tuples like this and in the usual way:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">fastuple</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">fastuple</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">fastuple</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="elementwise-operations">
<h3>Elementwise operations<a class="headerlink" href="#elementwise-operations" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">show_doc</span><span class="p">(</span><span class="n">fastuple</span><span class="o">.</span><span class="n">add</span><span class="p">,</span> <span class="n">title_level</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<h5 id="fastuple.add" class="doc_header"><code>fastuple.add</code><a href="__main__.py#L21" class="source_link" style="float:right">[source]</a></h5>
<blockquote>
<div><p><code>fastuple.add</code>(<strong>*<code class="docutils literal notranslate"><span class="pre">args</span></code></strong>)</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">+</span></code> is already defined in <code class="docutils literal notranslate"><span class="pre">tuple</span></code> for concat, so use <code class="docutils literal notranslate"><span class="pre">add</span></code> instead</p>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">fastuple</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">test_eq_type</span><span class="p">(</span><span class="n">fastuple</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">fastuple</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">fastuple</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;2&#39;</span><span class="p">),</span> <span class="n">fastuple</span><span class="p">(</span><span class="s1">&#39;12&#39;</span><span class="p">,</span><span class="s1">&#39;22&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">show_doc</span><span class="p">(</span><span class="n">fastuple</span><span class="o">.</span><span class="n">mul</span><span class="p">,</span> <span class="n">title_level</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<h5 id="fastuple.mul" class="doc_header"><code>fastuple.mul</code><a href="__main__.py#L17" class="source_link" style="float:right">[source]</a></h5>
<blockquote>
<div><p><code>fastuple.mul</code>(<strong>*<code class="docutils literal notranslate"><span class="pre">args</span></code></strong>)</p>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">*</span></code> is already defined in <code class="docutils literal notranslate"><span class="pre">tuple</span></code> for replicating, so use <code class="docutils literal notranslate"><span class="pre">mul</span></code> instead</p>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq_type</span><span class="p">(</span><span class="n">fastuple</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">fastuple</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="other-elementwise-operations">
<h3>Other Elementwise Operations<a class="headerlink" href="#other-elementwise-operations" title="Permalink to this headline">¶</a></h3>
<p>Additionally, the following elementwise operations are available:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">le</span></code>: less than</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">eq</span></code>: equal</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gt</span></code>: greater than</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">min</span></code>: minimum of</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">fastuple</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">le</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">fastuple</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">fastuple</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">gt</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">fastuple</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>You can also do other elemntwise operations like negate a <code class="docutils literal notranslate"><span class="pre">fastuple</span></code>, or subtract two <code class="docutils literal notranslate"><span class="pre">fastuple</span></code>s:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="o">-</span><span class="n">fastuple</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="o">~</span><span class="n">fastuple</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="kc">False</span><span class="p">))</span>

<span class="n">test_eq</span><span class="p">(</span><span class="n">fastuple</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">fastuple</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">fastuple</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="n">fastuple</span><span class="p">)</span>
<span class="n">test_eq_type</span><span class="p">(</span><span class="n">fastuple</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">fastuple</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">test_ne</span><span class="p">(</span><span class="n">fastuple</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">fastuple</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">fastuple</span><span class="p">(),</span> <span class="p">())</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="functions-on-functions">
<h2>Functions on Functions<a class="headerlink" href="#functions-on-functions" title="Permalink to this headline">¶</a></h2>
<p>Utilities for functional programming or for defining, modifying, or debugging functions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># export</span>
<span class="k">class</span> <span class="nc">_Arg</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="n">i</span>
<span class="n">arg0</span> <span class="o">=</span> <span class="n">_Arg</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">arg1</span> <span class="o">=</span> <span class="n">_Arg</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">arg2</span> <span class="o">=</span> <span class="n">_Arg</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">arg3</span> <span class="o">=</span> <span class="n">_Arg</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">arg4</span> <span class="o">=</span> <span class="n">_Arg</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">class</span> <span class="nc">bind</span><span class="p">:</span>
    <span class="s2">&quot;Same as `partial`, except you can use `arg0` `arg1` etc param placeholders&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">pargs</span><span class="p">,</span> <span class="o">**</span><span class="n">pkwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">pkwargs</span> <span class="o">=</span> <span class="n">func</span><span class="p">,</span><span class="n">pargs</span><span class="p">,</span><span class="n">pkwargs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxi</span> <span class="o">=</span> <span class="nb">max</span><span class="p">((</span><span class="n">x</span><span class="o">.</span><span class="n">i</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pargs</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">_Arg</span><span class="p">)),</span> <span class="n">default</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">args</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">pkwargs</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">_Arg</span><span class="p">):</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">i</span><span class="p">)</span>
        <span class="n">fargs</span> <span class="o">=</span> <span class="p">[</span><span class="n">args</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">_Arg</span><span class="p">)</span> <span class="k">else</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pargs</span><span class="p">]</span> <span class="o">+</span> <span class="n">args</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">maxi</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">fargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">show_doc</span><span class="p">(</span><span class="n">bind</span><span class="p">,</span> <span class="n">title_level</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<h3 id="bind" class="doc_header"><code>class</code> <code>bind</code><a href="" class="source_link" style="float:right">[source]</a></h3>
<blockquote>
<div><p><code>bind</code>(<strong><code class="docutils literal notranslate"><span class="pre">func</span></code></strong>, <strong>*<code class="docutils literal notranslate"><span class="pre">pargs</span></code></strong>, <strong>**<code class="docutils literal notranslate"><span class="pre">pkwargs</span></code></strong>)</p>
</div></blockquote>
<p>Same as <code class="docutils literal notranslate"><span class="pre">partial</span></code>, except you can use <a class="reference external" href="/basics.html#arg0"><code class="docutils literal notranslate"><span class="pre">arg0</span></code></a> <a class="reference external" href="/basics.html#arg1"><code class="docutils literal notranslate"><span class="pre">arg1</span></code></a> etc param placeholders</p>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">bind</span></code> is the same as <code class="docutils literal notranslate"><span class="pre">partial</span></code>, but also allows you to reorder positional arguments using variable name(s) <code class="docutils literal notranslate"><span class="pre">arg{i}</span></code> where i refers to the zero-indexed positional argument. <code class="docutils literal notranslate"><span class="pre">bind</span></code> as implemented currently only supports reordering of up to the first 5 positional arguments.</p>
<p>Consider the function <code class="docutils literal notranslate"><span class="pre">myfunc</span></code> below, which has 3 positional arguments.  These arguments can be referenced as <code class="docutils literal notranslate"><span class="pre">arg0</span></code>, <code class="docutils literal notranslate"><span class="pre">arg1</span></code>, and <code class="docutils literal notranslate"><span class="pre">arg1</span></code>, respectively.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">myfn</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">e</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span> <span class="k">return</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">e</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>In the below example we bind the positional arguments of <code class="docutils literal notranslate"><span class="pre">myfn</span></code> as follows:</p>
<ul class="simple">
<li><p>The second input <code class="docutils literal notranslate"><span class="pre">14</span></code>, referenced by <code class="docutils literal notranslate"><span class="pre">arg1</span></code>, is substituted for the first positional argument.</p></li>
<li><p>We supply a default value of <code class="docutils literal notranslate"><span class="pre">17</span></code> for the second positional argument.</p></li>
<li><p>The first input <code class="docutils literal notranslate"><span class="pre">19</span></code>, referenced by <code class="docutils literal notranslate"><span class="pre">arg0</span></code>, is subsituted for the third positional argument.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">bind</span><span class="p">(</span><span class="n">myfn</span><span class="p">,</span> <span class="n">arg1</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="n">arg0</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="mi">3</span><span class="p">)(</span><span class="mi">19</span><span class="p">,</span><span class="mi">14</span><span class="p">),</span> <span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>In this next example:</p>
<ul class="simple">
<li><p>We set the default value to <code class="docutils literal notranslate"><span class="pre">17</span></code> for the first positional argument.</p></li>
<li><p>The first input <code class="docutils literal notranslate"><span class="pre">19</span></code> refrenced by <code class="docutils literal notranslate"><span class="pre">arg0</span></code>, becomes the second positional argument.</p></li>
<li><p>The second input <code class="docutils literal notranslate"><span class="pre">14</span></code> becomes the third positional argument.</p></li>
<li><p>We override the default the value for named argument <code class="docutils literal notranslate"><span class="pre">e</span></code> to <code class="docutils literal notranslate"><span class="pre">3</span></code>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">bind</span><span class="p">(</span><span class="n">myfn</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="n">arg0</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="mi">3</span><span class="p">)(</span><span class="mi">19</span><span class="p">,</span><span class="mi">14</span><span class="p">),</span> <span class="p">(</span><span class="mi">17</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>This is an example of using <code class="docutils literal notranslate"><span class="pre">bind</span></code> like <code class="docutils literal notranslate"><span class="pre">partial</span></code> and do not reorder any arguments:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">bind</span><span class="p">(</span><span class="n">myfn</span><span class="p">)(</span><span class="mi">17</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">14</span><span class="p">),</span> <span class="p">(</span><span class="mi">17</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">bind</span></code> can also be used to change default values.  In the below example, we use the first input <code class="docutils literal notranslate"><span class="pre">3</span></code> to override the default value of the named argument <code class="docutils literal notranslate"><span class="pre">e</span></code>, and supply default values for the first three positional arguments:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">bind</span><span class="p">(</span><span class="n">myfn</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="n">e</span><span class="o">=</span><span class="n">arg0</span><span class="p">)(</span><span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">17</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">mapt</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">iterables</span><span class="p">):</span>
    <span class="s2">&quot;Tuplified `map`&quot;</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">iterables</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">mapt</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">neg</span><span class="p">,</span> <span class="n">t</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">map_ex</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">gen</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="s2">&quot;Like `map`, but use `bind`, and supports `str` and indexing&quot;</span>
    <span class="n">g</span> <span class="o">=</span> <span class="p">(</span><span class="n">bind</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
         <span class="k">else</span> <span class="n">f</span><span class="o">.</span><span class="n">format</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span>
         <span class="k">else</span> <span class="n">f</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">iterable</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gen</span><span class="p">:</span> <span class="k">return</span> <span class="n">res</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">map_ex</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">operator</span><span class="o">.</span><span class="n">neg</span><span class="p">),</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">f</span></code> is a string then it is treated as a format string to create the mapping:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">map_ex</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s1">&#39;#</span><span class="si">{}</span><span class="s1">#&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s1">&#39;#0#&#39;</span><span class="p">,</span><span class="s1">&#39;#1#&#39;</span><span class="p">,</span><span class="s1">&#39;#2#&#39;</span><span class="p">,</span><span class="s1">&#39;#3#&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">f</span></code> is a dictionary (or anything supporting <code class="docutils literal notranslate"><span class="pre">__getitem__</span></code>) then it is indexed to create the mapping:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">map_ex</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="s1">&#39;abcd&#39;</span><span class="p">)),</span> <span class="nb">list</span><span class="p">(</span><span class="s1">&#39;abcd&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>You can also pass the same <code class="docutils literal notranslate"><span class="pre">arg</span></code> params that <code class="docutils literal notranslate"><span class="pre">bind</span></code> accepts:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span> <span class="k">return</span> <span class="n">b</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">map_ex</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">arg0</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># export</span>
<span class="k">def</span> <span class="nf">compose</span><span class="p">(</span><span class="o">*</span><span class="n">funcs</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="s2">&quot;Create a function that composes all functions in `funcs`, passing along remaining `*args` and `**kwargs` to all&quot;</span>
    <span class="n">funcs</span> <span class="o">=</span> <span class="n">listify</span><span class="p">(</span><span class="n">funcs</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">funcs</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="n">noop</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">funcs</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span> <span class="k">return</span> <span class="n">funcs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">order</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">funcs</span> <span class="o">=</span> <span class="n">sorted_ex</span><span class="p">(</span><span class="n">funcs</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">order</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_inner</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">funcs</span><span class="p">:</span> <span class="n">x</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>
    <span class="k">return</span> <span class="n">_inner</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">f1</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">o</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="mi">0</span><span class="p">:</span> <span class="p">(</span><span class="n">o</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">p</span>
<span class="n">f2</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">o</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">:</span> <span class="p">(</span><span class="n">o</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">p</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">f2</span><span class="p">(</span><span class="n">f1</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span> <span class="n">compose</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span><span class="n">f2</span><span class="p">)(</span><span class="mi">3</span><span class="p">))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">f2</span><span class="p">(</span><span class="n">f1</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span><span class="n">p</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span> <span class="n">compose</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span><span class="n">f2</span><span class="p">)(</span><span class="mi">3</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">f2</span><span class="p">(</span><span class="n">f1</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">),</span>  <span class="mi">3</span><span class="p">),</span> <span class="n">compose</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span><span class="n">f2</span><span class="p">)(</span><span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">))</span>

<span class="n">f1</span><span class="o">.</span><span class="n">order</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">f1</span><span class="p">(</span><span class="n">f2</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span> <span class="n">compose</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span><span class="n">f2</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;order&quot;</span><span class="p">)(</span><span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">maps</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">retain</span><span class="o">=</span><span class="n">noop</span><span class="p">):</span>
    <span class="s2">&quot;Like `map`, except funcs are composed first&quot;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">compose</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">def</span> <span class="nf">_f</span><span class="p">(</span><span class="n">b</span><span class="p">):</span> <span class="k">return</span> <span class="n">retain</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">b</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="n">_f</span><span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">maps</span><span class="p">([</span><span class="mi">1</span><span class="p">]),</span> <span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">maps</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">neg</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]),</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">maps</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">neg</span><span class="p">,</span> <span class="n">operator</span><span class="o">.</span><span class="n">neg</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]),</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">partialler</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="s2">&quot;Like `functools.partial` but also copies over docstring&quot;</span>
    <span class="n">fnew</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">fnew</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="vm">__doc__</span>
    <span class="k">if</span> <span class="n">order</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">fnew</span><span class="o">.</span><span class="n">order</span><span class="o">=</span><span class="n">order</span>
    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="s1">&#39;order&#39;</span><span class="p">):</span> <span class="n">fnew</span><span class="o">.</span><span class="n">order</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">order</span>
    <span class="k">return</span> <span class="n">fnew</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">_f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="s2">&quot;test func&quot;</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">-</span><span class="n">a</span>
<span class="n">_f</span><span class="o">.</span><span class="n">order</span><span class="o">=</span><span class="mi">1</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">partialler</span><span class="p">(</span><span class="n">_f</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">order</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">partialler</span><span class="p">(</span><span class="n">_f</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">,</span> <span class="s2">&quot;test func&quot;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">order</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">_f</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">partial0</span><span class="p">:</span>
    <span class="s2">&quot;Like `partialler`, but args passed to callable are inserted at started, instead of at end&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">f</span><span class="p">,</span><span class="n">args</span><span class="p">,</span><span class="n">kwargs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">order</span> <span class="o">=</span> <span class="n">ifnone</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="s1">&#39;order&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="vm">__doc__</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">partial0</span><span class="p">(</span><span class="n">_f</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">order</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span> <span class="c1"># NB: different to `partialler` example</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">instantiate</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="s2">&quot;Instantiate `t` if it&#39;s a type, otherwise do nothing&quot;</span>
    <span class="k">return</span> <span class="n">t</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span> <span class="k">else</span> <span class="n">t</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq_type</span><span class="p">(</span><span class="n">instantiate</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">test_eq_type</span><span class="p">(</span><span class="n">instantiate</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">_using_attr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span> <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">attr</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">using_attr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
    <span class="s2">&quot;Change function `f` to operate on `attr`&quot;</span>
    <span class="k">return</span> <span class="n">partial</span><span class="p">(</span><span class="n">_using_attr</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;/a/b.txt&#39;</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">using_attr</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">upper</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="s1">&#39;B.TXT&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="self-with-an-uppercase-s">
<h3>Self (with an <em>uppercase</em> S)<a class="headerlink" href="#self-with-an-uppercase-s" title="Permalink to this headline">¶</a></h3>
<p>A Concise Way To Create Lambdas</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">class</span> <span class="nc">_Self</span><span class="p">:</span>
    <span class="s2">&quot;An alternative to `lambda` for calling methods on passed object.&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">nms</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ready</span> <span class="o">=</span> <span class="p">[],[],[],</span><span class="kc">True</span>
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;self: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nms</span><span class="si">}</span><span class="s1">(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="si">}</span><span class="s1">)&#39;</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ready</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">k</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nms</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">and</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">k</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">x</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ready</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">k</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ready</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ready</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="bp">self</span>
    
    <span class="k">def</span> <span class="nf">_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nms</span> <span class="o">=</span> <span class="p">[</span><span class="n">args</span><span class="p">],[</span><span class="n">kwargs</span><span class="p">],[</span><span class="s1">&#39;__call__&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ready</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="bp">self</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">class</span> <span class="nc">_SelfCls</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">k</span><span class="p">):</span> <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">_Self</span><span class="p">(),</span><span class="n">k</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">i</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getattr__</span><span class="p">(</span><span class="s1">&#39;__getitem__&#39;</span><span class="p">)(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__getattr__</span><span class="p">(</span><span class="s1">&#39;_call&#39;</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="n">Self</span> <span class="o">=</span> <span class="n">_SelfCls</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="n">_all_</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Self&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>This is a concise way to create lambdas that are calling methods on an object (note the capitalization!)</p>
<p><code class="docutils literal notranslate"><span class="pre">Self.sum()</span></code>, for instance, is a shortcut for <code class="docutils literal notranslate"><span class="pre">lambda</span> <span class="pre">o:</span> <span class="pre">o.sum()</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="n">Self</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">3.</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="mf">4.</span><span class="p">)</span>

<span class="c1"># This is equivalent to above</span>
<span class="n">f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">o</span><span class="p">:</span> <span class="n">o</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">3.</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="mf">4.</span><span class="p">)</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">Self</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
<span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">arr</span><span class="p">),</span> <span class="n">arr</span><span class="o">.</span><span class="n">argmin</span><span class="p">())</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">Self</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">is_integer</span><span class="p">()</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">3.</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="kc">True</span><span class="p">)</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">Self</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">real</span><span class="o">.</span><span class="n">is_integer</span><span class="p">()</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">3.</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="kc">True</span><span class="p">)</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">Self</span><span class="o">.</span><span class="n">imag</span><span class="p">()</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">Self</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Self</span></code> is also callable, which creates a function which calls any function passed to it, using the arguments passed to <code class="docutils literal notranslate"><span class="pre">Self</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span> <span class="k">return</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="o">+</span><span class="mi">2</span>
<span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span> <span class="k">return</span> <span class="n">a</span><span class="o">*</span><span class="n">b</span>
<span class="n">fg</span> <span class="o">=</span> <span class="n">Self</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">fg</span><span class="p">,</span> <span class="p">[</span><span class="n">f</span><span class="p">,</span><span class="n">g</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[5, 2]
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="patching">
<h2>Patching<a class="headerlink" href="#patching" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">copy_func</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="s2">&quot;Copy a non-builtin function (NB `copy.copy` does not work for this)&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">FunctionType</span><span class="p">):</span> <span class="k">return</span> <span class="n">copy</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">fn</span> <span class="o">=</span> <span class="n">FunctionType</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="vm">__code__</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="vm">__globals__</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="vm">__defaults__</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="vm">__closure__</span><span class="p">)</span>
    <span class="n">fn</span><span class="o">.</span><span class="vm">__kwdefaults__</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="vm">__kwdefaults__</span>
    <span class="n">fn</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fn</span>
</pre></div>
</div>
</div>
</div>
<p>Sometimes it may be desirable to make a copy of a function that doesn’t point to the original object.  When you use Python’s built in <code class="docutils literal notranslate"><span class="pre">copy.copy</span></code> or <code class="docutils literal notranslate"><span class="pre">copy.deepcopy</span></code> to copy a function, you get a reference to the original object:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">copy</span> <span class="k">as</span> <span class="nn">cp</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">():</span> <span class="k">pass</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>

<span class="n">a</span><span class="o">.</span><span class="n">someattr</span> <span class="o">=</span> <span class="s1">&#39;hello&#39;</span> <span class="c1"># since a and b point at the same object, updating a will update b</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">someattr</span><span class="p">,</span> <span class="s1">&#39;hello&#39;</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">a</span> <span class="ow">is</span> <span class="n">foo</span> <span class="ow">and</span> <span class="n">b</span> <span class="ow">is</span> <span class="n">foo</span>
</pre></div>
</div>
</div>
</div>
<p>However, with <code class="docutils literal notranslate"><span class="pre">copy_func</span></code>, you can retrieve a copy of a function without a reference to the original object:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">copy_func</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span> <span class="c1"># c is an indpendent object</span>
<span class="k">assert</span> <span class="n">c</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">foo</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">+</span><span class="n">y</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">copy_func</span><span class="p">(</span><span class="n">g</span><span class="p">)(</span><span class="mi">4</span><span class="p">),</span> <span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">patch_to</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">as_prop</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cls_method</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="s2">&quot;Decorator: add `f` to `cls`&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span><span class="nb">list</span><span class="p">)):</span> <span class="bp">cls</span><span class="o">=</span><span class="p">(</span><span class="bp">cls</span><span class="p">,)</span>
    <span class="k">def</span> <span class="nf">_inner</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">c_</span> <span class="ow">in</span> <span class="bp">cls</span><span class="p">:</span>
            <span class="n">nf</span> <span class="o">=</span> <span class="n">copy_func</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="n">nm</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="c1"># `functools.update_wrapper` when passing patched function to `Pipeline`, so we do it manually</span>
            <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">functools</span><span class="o">.</span><span class="n">WRAPPER_ASSIGNMENTS</span><span class="p">:</span> <span class="nb">setattr</span><span class="p">(</span><span class="n">nf</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">o</span><span class="p">))</span>
            <span class="n">nf</span><span class="o">.</span><span class="vm">__qualname__</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">c_</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">nm</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">if</span> <span class="n">cls_method</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">c_</span><span class="p">,</span> <span class="n">nm</span><span class="p">,</span> <span class="n">MethodType</span><span class="p">(</span><span class="n">nf</span><span class="p">,</span> <span class="n">c_</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">c_</span><span class="p">,</span> <span class="n">nm</span><span class="p">,</span> <span class="nb">property</span><span class="p">(</span><span class="n">nf</span><span class="p">)</span> <span class="k">if</span> <span class="n">as_prop</span> <span class="k">else</span> <span class="n">nf</span><span class="p">)</span>
        <span class="c1"># Avoid clobbering existing functions</span>
        <span class="k">return</span> <span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">nm</span><span class="p">,</span> <span class="n">builtins</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">nm</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">_inner</span>
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">&#64;patch_to</span></code> decorator allows you to <a class="reference external" href="https://stackoverflow.com/questions/5626193/what-is-monkey-patching">monkey patch</a> a function into a class as a method:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">_T3</span><span class="p">(</span><span class="nb">int</span><span class="p">):</span> <span class="k">pass</span>  

<span class="nd">@patch_to</span><span class="p">(</span><span class="n">_T3</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">func1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">+</span><span class="n">a</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">_T3</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># we initilized `t` to a type int = 1</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">func1</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span> <span class="c1"># we add 2 to `t`, so 2 + 1 = 3</span>
</pre></div>
</div>
</div>
</div>
<p>You can access instance properties in the usual way via <code class="docutils literal notranslate"><span class="pre">self</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">_T4</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="n">g</span>
        
<span class="nd">@patch_to</span><span class="p">(</span><span class="n">_T4</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">greet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">+</span> <span class="n">x</span>
        
<span class="n">t</span> <span class="o">=</span> <span class="n">_T4</span><span class="p">(</span><span class="s1">&#39;hello &#39;</span><span class="p">)</span> <span class="c1"># this sets self.g = &#39;helllo &#39;</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">greet</span><span class="p">(</span><span class="s1">&#39;world&#39;</span><span class="p">),</span> <span class="s1">&#39;hello world&#39;</span><span class="p">)</span> <span class="c1">#t.greet(&#39;world&#39;) will append &#39;world&#39; to &#39;hello &#39;</span>
</pre></div>
</div>
</div>
</div>
<p>You can instead specify that the method should be a class method by setting <code class="docutils literal notranslate"><span class="pre">cls_method=True</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">_T5</span><span class="p">(</span><span class="nb">int</span><span class="p">):</span> <span class="n">attr</span> <span class="o">=</span> <span class="mi">3</span> <span class="c1"># attr is a class attribute we will access in a later method</span>
    
<span class="nd">@patch_to</span><span class="p">(</span><span class="n">_T5</span><span class="p">,</span> <span class="n">cls_method</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span> <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">attr</span> <span class="o">+</span> <span class="n">x</span> <span class="c1"># you can access class attributes in the normal way</span>

<span class="n">test_eq</span><span class="p">(</span><span class="n">_T5</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Additionally you can specify that the function you want to patch should be a class attribute with <code class="docutils literal notranslate"><span class="pre">as_prop</span></code> = False</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@patch_to</span><span class="p">(</span><span class="n">_T5</span><span class="p">,</span> <span class="n">as_prop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">add_ten</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="mi">10</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">_T5</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">add_ten</span><span class="p">,</span> <span class="mi">14</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Instead of passing one class to the <code class="docutils literal notranslate"><span class="pre">&#64;patch_to</span></code> decorator, you can pass multiple classes in a tuple to simulteanously patch more than one class with the same method:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">_T6</span><span class="p">(</span><span class="nb">int</span><span class="p">):</span> <span class="k">pass</span>
<span class="k">class</span> <span class="nc">_T7</span><span class="p">(</span><span class="nb">int</span><span class="p">):</span> <span class="k">pass</span>

<span class="nd">@patch_to</span><span class="p">((</span><span class="n">_T6</span><span class="p">,</span><span class="n">_T7</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">func_mult</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">*</span><span class="n">a</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">_T6</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">func_mult</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">_T7</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">func_mult</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="mi">8</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">patch</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">as_prop</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cls_method</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="s2">&quot;Decorator: add `f` to the first parameter&#39;s class (based on f&#39;s type annotations)&quot;</span>
    <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span> <span class="n">partial</span><span class="p">(</span><span class="n">patch</span><span class="p">,</span> <span class="n">as_prop</span><span class="o">=</span><span class="n">as_prop</span><span class="p">,</span> <span class="n">cls_method</span><span class="o">=</span><span class="n">cls_method</span><span class="p">)</span>
    <span class="bp">cls</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="vm">__annotations__</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
    <span class="k">return</span> <span class="n">patch_to</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">as_prop</span><span class="o">=</span><span class="n">as_prop</span><span class="p">,</span> <span class="n">cls_method</span><span class="o">=</span><span class="n">cls_method</span><span class="p">)(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">&#64;patch</span></code> is an alternative to <code class="docutils literal notranslate"><span class="pre">&#64;patch_to</span></code> that allows you similarly monkey patch class(es) by using <a class="reference external" href="https://docs.python.org/3/library/typing.html">type annotations</a>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">_T8</span><span class="p">(</span><span class="nb">int</span><span class="p">):</span> <span class="k">pass</span>  

<span class="nd">@patch</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span><span class="n">_T8</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">+</span><span class="n">a</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">_T8</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># we initilized `t` to a type int = 1</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span> <span class="c1"># we add 3 to `t`, so 3 + 1 = 4</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="vm">__qualname__</span><span class="p">,</span> <span class="s1">&#39;_T8.func&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Similarly to <code class="docutils literal notranslate"><span class="pre">patch_to</span></code>, you can supply a tuple of classes instead of a single class in your type annotations to patch multiple classes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">_T9</span><span class="p">(</span><span class="nb">int</span><span class="p">):</span> <span class="k">pass</span> 

<span class="nd">@patch</span>
<span class="k">def</span> <span class="nf">func2</span><span class="p">(</span><span class="n">x</span><span class="p">:(</span><span class="n">_T8</span><span class="p">,</span><span class="n">_T9</span><span class="p">),</span> <span class="n">a</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="n">a</span> <span class="c1"># will patch both _T8 and _T9</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">_T8</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">func2</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">func2</span><span class="o">.</span><span class="vm">__qualname__</span><span class="p">,</span> <span class="s1">&#39;_T8.func2&#39;</span><span class="p">)</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">_T9</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">func2</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="mi">8</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">func2</span><span class="o">.</span><span class="vm">__qualname__</span><span class="p">,</span> <span class="s1">&#39;_T9.func2&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Just like <code class="docutils literal notranslate"><span class="pre">patch_to</span></code> decorator you can use <code class="docutils literal notranslate"><span class="pre">as_propas_prop</span></code> and <code class="docutils literal notranslate"><span class="pre">cls_method</span></code> parameters with <code class="docutils literal notranslate"><span class="pre">patch</span></code> decorator:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@patch</span><span class="p">(</span><span class="n">as_prop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">add_ten</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span><span class="n">_T5</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="mi">10</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">_T5</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">add_ten</span><span class="p">,</span> <span class="mi">14</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">_T5</span><span class="p">(</span><span class="nb">int</span><span class="p">):</span> <span class="n">attr</span> <span class="o">=</span> <span class="mi">3</span> <span class="c1"># attr is a class attribute we will access in a later method</span>
    
<span class="nd">@patch</span><span class="p">(</span><span class="n">cls_method</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span><span class="n">_T5</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span> <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">attr</span> <span class="o">+</span> <span class="n">x</span> <span class="c1"># you can access class attributes in the normal way</span>

<span class="n">test_eq</span><span class="p">(</span><span class="n">_T5</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">patch_property</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="s2">&quot;Deprecated; use `patch(as_prop=True)` instead&quot;</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;`patch_property` is deprecated and will be removed; use `patch(as_prop=True)` instead&quot;</span><span class="p">)</span>
    <span class="bp">cls</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="vm">__annotations__</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
    <span class="k">return</span> <span class="n">patch_to</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">as_prop</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="other-helpers">
<h2>Other Helpers<a class="headerlink" href="#other-helpers" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">class</span> <span class="nc">ImportEnum</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">):</span>
    <span class="s2">&quot;An `Enum` that can have its values imported&quot;</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">imports</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">f_locals</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">cls</span><span class="p">:</span> <span class="n">g</span><span class="p">[</span><span class="n">o</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">=</span><span class="n">o</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">show_doc</span><span class="p">(</span><span class="n">ImportEnum</span><span class="p">,</span> <span class="n">title_level</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<h4 id="ImportEnum" class="doc_header"><code>ImportEnum</code><a href="" class="source_link" style="float:right">[source]</a></h4>
<blockquote>
<div><p><code>Enum</code> = []</p>
</div></blockquote>
<p>An <code class="docutils literal notranslate"><span class="pre">Enum</span></code> that can have its values imported</p>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">_T</span> <span class="o">=</span> <span class="n">ImportEnum</span><span class="p">(</span><span class="s1">&#39;_T&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;foobar&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;goobar&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">})</span>
<span class="n">_T</span><span class="o">.</span><span class="n">imports</span><span class="p">()</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">foobar</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">foobar</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">goobar</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">goobar</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">class</span> <span class="nc">StrEnum</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="n">ImportEnum</span><span class="p">):</span>
    <span class="s2">&quot;An `ImportEnum` that behaves like a `str`&quot;</span>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">show_doc</span><span class="p">(</span><span class="n">StrEnum</span><span class="p">,</span> <span class="n">title_level</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<h4 id="StrEnum" class="doc_header"><code>StrEnum</code><a href="" class="source_link" style="float:right">[source]</a></h4>
<blockquote>
<div><p><code>Enum</code> = []</p>
</div></blockquote>
<p>An <code class="docutils literal notranslate"><span class="pre">ImportEnum</span></code> that behaves like a <code class="docutils literal notranslate"><span class="pre">str</span></code></p>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">str_enum</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">vals</span><span class="p">):</span>
    <span class="s2">&quot;Simplified creation of `StrEnum` types&quot;</span>
    <span class="k">return</span> <span class="n">StrEnum</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">{</span><span class="n">o</span><span class="p">:</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">_T</span> <span class="o">=</span> <span class="n">str_enum</span><span class="p">(</span><span class="s1">&#39;_T&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">_T</span><span class="o">.</span><span class="n">a</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">_T</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">_T</span><span class="o">.</span><span class="n">__members__</span><span class="p">),</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">_T</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">_T</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>a A
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">class</span> <span class="nc">Stateful</span><span class="p">:</span>
    <span class="s2">&quot;A base class/mixin for objects that should not serialize all their state&quot;</span>
    <span class="n">_stateattrs</span><span class="o">=</span><span class="p">()</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_state</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="c1"># required for mixin usage</span>
    
    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stateattrs</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39;_state&#39;</span><span class="p">,)}</span>
    
    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_state</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_init_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Override for custom init and deserialization logic&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">show_doc</span><span class="p">(</span><span class="n">Stateful</span><span class="p">,</span> <span class="n">title_level</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<h4 id="Stateful" class="doc_header"><code>class</code> <code>Stateful</code><a href="" class="source_link" style="float:right">[source]</a></h4>
<blockquote>
<div><p><code>Stateful</code>(<strong>*<code class="docutils literal notranslate"><span class="pre">args</span></code></strong>, <strong>**<code class="docutils literal notranslate"><span class="pre">kwargs</span></code></strong>)</p>
</div></blockquote>
<p>A base class/mixin for objects that should not serialize all their state</p>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">_T</span><span class="p">(</span><span class="n">Stateful</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">2</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">_T</span><span class="p">()</span>
<span class="n">t2</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">a</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">_state</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">],</span><span class="mi">2</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t2</span><span class="o">.</span><span class="n">a</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t2</span><span class="o">.</span><span class="n">_state</span><span class="p">,{})</span>
</pre></div>
</div>
</div>
</div>
<p>Override <code class="docutils literal notranslate"><span class="pre">_init_state</span></code> to do any necessary setup steps that are required during <code class="docutils literal notranslate"><span class="pre">__init__</span></code> or during deserialization (e.g. <code class="docutils literal notranslate"><span class="pre">pickle.load</span></code>). Here’s an example of how <code class="docutils literal notranslate"><span class="pre">Stateful</span></code> simplifies the official Python example for <a class="reference external" href="https://docs.python.org/3/library/pickle.html#handling-stateful-objects">Handling Stateful Objects</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TextReader</span><span class="p">(</span><span class="n">Stateful</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Print and number lines in a text file.&quot;&quot;&quot;</span>
    <span class="n">_stateattrs</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;file&#39;</span><span class="p">,)</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">lineno</span> <span class="o">=</span> <span class="n">filename</span><span class="p">,</span><span class="mi">0</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">readline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lineno</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">line</span><span class="p">:</span> <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lineno</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="nf">_init_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lineno</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">reader</span> <span class="o">=</span> <span class="n">TextReader</span><span class="p">(</span><span class="s2">&quot;00_test.ipynb&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">())</span>

<span class="n">new_reader</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">reader</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">reader</span><span class="o">.</span><span class="n">readline</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1: {
2: &quot;cells&quot;: [
3: {
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">class</span> <span class="nc">PrettyString</span><span class="p">(</span><span class="nb">str</span><span class="p">):</span>
    <span class="s2">&quot;Little hack to get strings to show properly in Jupyter.&quot;</span>
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">show_doc</span><span class="p">(</span><span class="n">PrettyString</span><span class="p">,</span> <span class="n">title_level</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<h4 id="PrettyString" class="doc_header"><code>class</code> <code>PrettyString</code><a href="" class="source_link" style="float:right">[source]</a></h4>
<blockquote>
<div><p><code>PrettyString</code>() :: <code class="docutils literal notranslate"><span class="pre">str</span></code></p>
</div></blockquote>
<p>Little hack to get strings to show properly in Jupyter.</p>
</div>
</div>
<p>Allow strings with special characters to render properly in Jupyter.  Without calling <code class="docutils literal notranslate"><span class="pre">print()</span></code> strings with special characters are displayed like so:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">with_special_chars</span><span class="o">=</span><span class="s1">&#39;a string</span><span class="se">\n</span><span class="s1">with</span><span class="se">\n</span><span class="s1">new</span><span class="se">\n</span><span class="s1">lines and</span><span class="se">\t</span><span class="s1">tabs&#39;</span>
<span class="n">with_special_chars</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;a string\nwith\nnew\nlines and\ttabs&#39;
</pre></div>
</div>
</div>
</div>
<p>We can correct this with <code class="docutils literal notranslate"><span class="pre">PrettyString</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PrettyString</span><span class="p">(</span><span class="n">with_special_chars</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>a string
with
new
lines and	tabs
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">even_mults</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="s2">&quot;Build log-stepped array from `start` to `stop` in `n` steps.&quot;</span>
    <span class="k">if</span> <span class="n">n</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span> <span class="k">return</span> <span class="n">stop</span>
    <span class="n">mult</span> <span class="o">=</span> <span class="n">stop</span><span class="o">/</span><span class="n">start</span>
    <span class="n">step</span> <span class="o">=</span> <span class="n">mult</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">start</span><span class="o">*</span><span class="p">(</span><span class="n">step</span><span class="o">**</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test_eq</span><span class="p">(</span><span class="n">even_mults</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">even_mults</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">32</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">even_mults</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="mi">8</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">num_cpus</span><span class="p">():</span>
    <span class="s2">&quot;Get number of cpus&quot;</span>
    <span class="k">try</span><span class="p">:</span>                   <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sched_getaffinity</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span> <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>

<span class="n">defaults</span><span class="o">.</span><span class="n">cpus</span> <span class="o">=</span> <span class="n">num_cpus</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">num_cpus</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>12
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">add_props</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="s2">&quot;Create properties passing each of `range(n)` to f&quot;</span>
    <span class="k">if</span> <span class="n">g</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span> <span class="p">(</span><span class="nb">property</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
    <span class="k">return</span> <span class="p">(</span><span class="nb">property</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">i</span><span class="p">),</span> <span class="n">partial</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">_T</span><span class="p">():</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="n">add_props</span><span class="p">(</span><span class="k">lambda</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span><span class="p">:</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">_T</span><span class="p">()</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">a</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">b</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">_T</span><span class="p">():</span> 
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="o">=</span><span class="n">v</span>
    <span class="k">def</span> <span class="nf">_set</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="n">add_props</span><span class="p">(</span><span class="k">lambda</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">_set</span><span class="p">)</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">_T</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">a</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">b</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">a</span><span class="o">+</span><span class="mi">1</span>
<span class="n">t</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">a</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">b</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">_typeerr</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">typ</span><span class="p">):</span> <span class="k">return</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">arg</span><span class="si">}</span><span class="s2">==</span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s2"> not </span><span class="si">{</span><span class="n">typ</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export</span>
<span class="k">def</span> <span class="nf">typed</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="s2">&quot;Decorator to check param and return types at runtime&quot;</span>
    <span class="n">names</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="vm">__code__</span><span class="o">.</span><span class="n">co_varnames</span>
    <span class="n">anno</span> <span class="o">=</span> <span class="n">annotations</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">anno</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;return&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">kw</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">kwargs</span><span class="p">}</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">anno</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">arg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">args</span><span class="p">):</span> <span class="n">kw</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">arg</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">kw</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">anno</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">anno</span><span class="p">[</span><span class="n">k</span><span class="p">]):</span> <span class="k">raise</span> <span class="n">_typeerr</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">anno</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ret</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="n">ret</span><span class="p">):</span> <span class="k">raise</span> <span class="n">_typeerr</span><span class="p">(</span><span class="s2">&quot;return&quot;</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">ret</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span>
    <span class="k">return</span> <span class="n">functools</span><span class="o">.</span><span class="n">update_wrapper</span><span class="p">(</span><span class="n">_f</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">typed</span></code> validates argument types at <strong>runtime</strong>.  This is in contrast to <a class="reference external" href="http://mypy-lang.org/">MyPy</a> which only offers static type checking.</p>
<p>For example, a <code class="docutils literal notranslate"><span class="pre">TypeError</span></code> will be raised if we try to pass an integer into the first argument of the below function:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@typed</span>
<span class="k">def</span> <span class="nf">discount</span><span class="p">(</span><span class="n">price</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">pct</span><span class="p">:</span><span class="nb">float</span><span class="p">):</span> 
    <span class="k">return</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">pct</span><span class="p">)</span> <span class="o">*</span> <span class="n">price</span>

<span class="k">with</span> <span class="n">ExceptionExpected</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span> <span class="n">discount</span><span class="p">(</span><span class="mf">100.0</span><span class="p">,</span> <span class="o">.</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can also optionally allow multiple types by enumarating the types in a tuple as illustrated below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">discount</span><span class="p">(</span><span class="n">price</span><span class="p">:(</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">),</span> <span class="n">pct</span><span class="p">:</span><span class="nb">float</span><span class="p">):</span> 
    <span class="k">return</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">pct</span><span class="p">)</span> <span class="o">*</span> <span class="n">price</span>

<span class="k">assert</span> <span class="mf">90.0</span> <span class="o">==</span> <span class="n">discount</span><span class="p">(</span><span class="mf">100.0</span><span class="p">,</span> <span class="o">.</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@typed</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">):</span> <span class="k">return</span> <span class="n">a</span>
<span class="n">test_eq</span><span class="p">(</span><span class="n">foo</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

<span class="k">with</span> <span class="n">ExceptionExpected</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span> <span class="n">foo</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>

<span class="nd">@typed</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">()</span><span class="o">-&gt;</span><span class="nb">str</span><span class="p">:</span> <span class="k">return</span> <span class="mi">1</span>
<span class="k">with</span> <span class="n">ExceptionExpected</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span> <span class="n">foo</span><span class="p">()</span>

<span class="nd">@typed</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">()</span><span class="o">-&gt;</span><span class="nb">str</span><span class="p">:</span> <span class="k">return</span> <span class="s1">&#39;1&#39;</span>
<span class="k">assert</span> <span class="n">foo</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">typed</span></code> works with classes, too:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Foo</span><span class="p">:</span>
    <span class="nd">@typed</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span> <span class="k">pass</span>
    <span class="nd">@typed</span>
    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span> <span class="k">return</span> <span class="n">d</span>

<span class="k">with</span> <span class="n">ExceptionExpected</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span> <span class="n">Foo</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> 
<span class="k">with</span> <span class="n">ExceptionExpected</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">):</span> <span class="n">Foo</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;a string&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="notebook-functions">
<h2>Notebook functions<a class="headerlink" href="#notebook-functions" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">show_doc</span><span class="p">(</span><span class="n">ipython_shell</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<h4 id="ipython_shell" class="doc_header"><code>ipython_shell</code><a href="https://github.com/fastai/fastcore/tree/master/fastcore/imports.py#L67" class="source_link" style="float:right">[source]</a></h4>
<blockquote>
<div><p><code>ipython_shell</code>()</p>
</div></blockquote>
<p>Same as <code class="docutils literal notranslate"><span class="pre">get_ipython</span></code> but returns <code class="docutils literal notranslate"><span class="pre">False</span></code> if not in IPython</p>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">show_doc</span><span class="p">(</span><span class="n">in_ipython</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<h4 id="in_ipython" class="doc_header"><code>in_ipython</code><a href="https://github.com/fastai/fastcore/tree/master/fastcore/imports.py#L72" class="source_link" style="float:right">[source]</a></h4>
<blockquote>
<div><p><code>in_ipython</code>()</p>
</div></blockquote>
<p>Check if code is running in some kind of IPython environment</p>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">show_doc</span><span class="p">(</span><span class="n">in_colab</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<h4 id="in_colab" class="doc_header"><code>in_colab</code><a href="https://github.com/fastai/fastcore/tree/master/fastcore/imports.py#L76" class="source_link" style="float:right">[source]</a></h4>
<blockquote>
<div><p><code>in_colab</code>()</p>
</div></blockquote>
<p>Check if the code is running in Google Colaboratory</p>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">show_doc</span><span class="p">(</span><span class="n">in_jupyter</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<h4 id="in_jupyter" class="doc_header"><code>in_jupyter</code><a href="https://github.com/fastai/fastcore/tree/master/fastcore/imports.py#L80" class="source_link" style="float:right">[source]</a></h4>
<blockquote>
<div><p><code>in_jupyter</code>()</p>
</div></blockquote>
<p>Check if the code is running in a jupyter notebook</p>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">show_doc</span><span class="p">(</span><span class="n">in_notebook</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<h4 id="in_notebook" class="doc_header"><code>in_notebook</code><a href="https://github.com/fastai/fastcore/tree/master/fastcore/imports.py#L85" class="source_link" style="float:right">[source]</a></h4>
<blockquote>
<div><p><code>in_notebook</code>()</p>
</div></blockquote>
<p>Check if the code is running in a jupyter notebook</p>
</div>
</div>
<p>These variables are available as booleans in <code class="docutils literal notranslate"><span class="pre">fastcore.basics</span></code> as <code class="docutils literal notranslate"><span class="pre">IN_IPYTHON</span></code>, <code class="docutils literal notranslate"><span class="pre">IN_JUPYTER</span></code>, <code class="docutils literal notranslate"><span class="pre">IN_COLAB</span></code> and <code class="docutils literal notranslate"><span class="pre">IN_NOTEBOOK</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">IN_IPYTHON</span><span class="p">,</span> <span class="n">IN_JUPYTER</span><span class="p">,</span> <span class="n">IN_COLAB</span><span class="p">,</span> <span class="n">IN_NOTEBOOK</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(True, True, False, True)
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="export">
<h1>Export -<a class="headerlink" href="#export" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#hide</span>
<span class="kn">from</span> <span class="nn">nbdev.export</span> <span class="kn">import</span> <span class="n">notebook2script</span>
<span class="n">notebook2script</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Converted 00_test.ipynb.
Converted 01_basics.ipynb.
Converted 02_foundation.ipynb.
Converted 03_xtras.ipynb.
Converted 03a_parallel.ipynb.
Converted 03b_net.ipynb.
Converted 04_dispatch.ipynb.
Converted 05_transform.ipynb.
Converted 07_meta.ipynb.
Converted 08_script.ipynb.
Converted index.ipynb.
</pre></div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="00_test.html" title="previous page">Test</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Hamel Husain<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>